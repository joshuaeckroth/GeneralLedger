<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>General Ledger: client.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>client.cpp</h1><a href="client_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/* General Ledger, Copyright (C) 2004  Joshua Eckroth &lt;josh@eckroth.net&gt;</span>
00002 <span class="comment"> * http://www.eckroth.net/software/genledg</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
00005 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment"> * (at your option) any later version.</span>
00008 <span class="comment"> * </span>
00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment"> * GNU General Public License for more details.</span>
00013 <span class="comment"> * </span>
00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
00015 <span class="comment"> * along with this program; if not, write to the Free Software</span>
00016 <span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  US</span>
00017 <span class="comment">*/</span>
00018 
00019 <span class="preprocessor">#include &lt;qstring.h&gt;</span>
00020 <span class="preprocessor">#include &lt;qstringlist.h&gt;</span>
00021 <span class="preprocessor">#include &lt;qfile.h&gt;</span>
00022 <span class="preprocessor">#include &lt;qdatastream.h&gt;</span>
00023 <span class="preprocessor">#include &lt;qdir.h&gt;</span>
00024 
00025 <span class="preprocessor">#include "<a class="code" href="client_8h.html">client.h</a>"</span>
00026 <span class="preprocessor">#include "<a class="code" href="accountsData_8h.html">accountsData.h</a>"</span>
00027 <span class="preprocessor">#include "<a class="code" href="journalData_8h.html">journalData.h</a>"</span>
00028 <span class="preprocessor">#include "<a class="code" href="reportsEditor_8h.html">reportsEditor.h</a>"</span>
00029 <span class="preprocessor">#include "<a class="code" href="settings_8h.html">settings.h</a>"</span>
00030 
00031 
<a name="l00032"></a><a class="code" href="classClient.html#v0">00032</a> <a class="code" href="classClient.html">Client</a> *<a class="code" href="classClient.html#v0">Client::thisInstance</a> = 0;
00033 
<a name="l00034"></a><a class="code" href="classClient.html#e0">00034</a> <a class="code" href="classClient.html">Client</a>* <a class="code" href="classClient.html#e0">Client::instance</a>()
00035 {
00036     <span class="keywordflow">if</span>(<a class="code" href="classClient.html#v0">thisInstance</a> == 0)
00037         <a class="code" href="classClient.html#v0">thisInstance</a> = <span class="keyword">new</span> <a class="code" href="classClient.html">Client</a>;
00038     <span class="keywordflow">return</span> <a class="code" href="classClient.html#v0">thisInstance</a>;
00039 }
00040 
00041 
<a name="l00042"></a><a class="code" href="classClient.html#a0">00042</a> <span class="keywordtype">void</span> <a class="code" href="classClient.html#a0">Client::destroy</a>()
00043 {
00044     <span class="keywordflow">if</span>(<a class="code" href="classClient.html#v0">thisInstance</a> != 0)
00045         <span class="keyword">delete</span> <a class="code" href="classClient.html#v0">thisInstance</a>;
00046 }
00047 
<a name="l00048"></a><a class="code" href="classClient.html#a1">00048</a> <span class="keywordtype">void</span> <a class="code" href="classClient.html#a1">Client::initiate</a>()
00049 {
00050     accountsData = <a class="code" href="classAccountsData.html#e0">AccountsData::instance</a>();
00051     journalData = <a class="code" href="classJournalData.html#e0">JournalData::instance</a>();
00052     <a class="code" href="classClient.html#r2">reportsEditor</a> = <a class="code" href="classReportsEditor.html#e0">ReportsEditor::instance</a>();
00053 
00054     connect(accountsData, SIGNAL(<a class="code" href="classClient.html#i0">saveToDisk</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="classClient.html#i0">saveToDisk</a>()));
00055     connect(journalData, SIGNAL(<a class="code" href="classClient.html#i0">saveToDisk</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="classClient.html#i0">saveToDisk</a>()));
00056     connect(<a class="code" href="classClient.html#r2">reportsEditor</a>, SIGNAL(<a class="code" href="classClient.html#i0">saveToDisk</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="classClient.html#i0">saveToDisk</a>()));
00057 
00058     <a class="code" href="classClient.html#r3">settings</a> = <a class="code" href="classSettings.html#e0">Settings::instance</a>();
00059 
00060     <a class="code" href="classClient.html#r4">clientId</a> = <a class="code" href="classClient.html#r3">settings</a>-&gt;<a class="code" href="classSettings.html#a7">getDefaultClientId</a>();
00061 
00062     <span class="keywordflow">if</span>(<a class="code" href="classClient.html#a10">defaultClientExists</a>())
00063         <a class="code" href="classClient.html#r5">clientName</a> = <a class="code" href="classClient.html#r3">settings</a>-&gt;<a class="code" href="classSettings.html#a9">getDefaultClientName</a>();
00064     <span class="keywordflow">else</span>
00065     {
00066         <a class="code" href="classClient.html#r4">clientId</a> = <span class="stringliteral">""</span>;
00067         <a class="code" href="classClient.html#r5">clientName</a> = <span class="stringliteral">""</span>;
00068     }
00069 
00070     <a class="code" href="classClient.html#r6">clientOpen</a> = <span class="keyword">false</span>;
00071 }
00072 
<a name="l00073"></a><a class="code" href="classClient.html#a2">00073</a> <span class="keywordtype">void</span> <a class="code" href="classClient.html#a2">Client::create</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> newClientName, <span class="keywordtype">int</span> newYearEndMonth,
00074                 <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> REAccountId)
00075 {
00076     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> filename(newClientName);
00077     filename.replace(<a class="codeRef" doxygen="doxy-qt.tag:" href="qchar.html">QChar</a>(<span class="charliteral">' '</span>), <span class="stringliteral">"_"</span>);
00078     filename.replace(<a class="codeRef" doxygen="doxy-qt.tag:" href="qchar.html">QChar</a>(<span class="charliteral">'/'</span>), <span class="stringliteral">"-"</span>);
00079     filename.replace(<a class="codeRef" doxygen="doxy-qt.tag:" href="qchar.html">QChar</a>(<span class="charliteral">'\\'</span>), <span class="stringliteral">"-"</span>);
00080     filename.append(<span class="stringliteral">".glc"</span>);
00081 
00082     <a class="code" href="classClient.html#r4">clientId</a> = filename;
00083     <a class="code" href="classClient.html#r5">clientName</a> = newClientName;
00084     <a class="code" href="classClient.html#r7">yearEndMonth</a> = newYearEndMonth;
00085 
00086     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> REAccountDesc = <span class="stringliteral">"Retained Earnings"</span>;
00087 
00088     <a class="codeRef" doxygen="doxy-qt.tag:" href="qfile.html">QFile</a> file(<a class="code" href="classClient.html#r3">settings</a>-&gt;<a class="code" href="classSettings.html#a1">getClientPath</a>() + <span class="stringliteral">"/"</span> + filename);
00090     <span class="keywordflow">if</span>(!file.open(IO_WriteOnly))
00091     {
00092         <span class="keywordflow">return</span>;
00093     }
00094 
00095     <a class="codeRef" doxygen="doxy-qt.tag:" href="qdatastream.html">QDataStream</a> out(&amp;file);
00096     out.setVersion(5);
00097 
00098     out &lt;&lt; (Q_UINT32)<a class="code" href="classClient.html#y2y0">MagicNumber</a>
00099         &lt;&lt; (Q_UINT8)<a class="code" href="classClient.html#y3y1">Version</a>
00100         &lt;&lt; <a class="code" href="classClient.html#r5">clientName</a>
00101         &lt;&lt; <a class="code" href="classClient.html#r7">yearEndMonth</a>
00102         &lt;&lt; QDate::currentDate(Qt::UTC)
00103         &lt;&lt; QDate::currentDate(Qt::UTC)
00104         &lt;&lt; (Q_UINT16)0
00105         &lt;&lt; REAccountId
00106         &lt;&lt; REAccountDesc
00107         &lt;&lt; (Q_UINT16)0
00108         &lt;&lt; (Q_UINT32)0
00109         &lt;&lt; (Q_UINT16)0;
00110 
00111     out.unsetDevice();
00112 
00113     file.close();
00114 
00115     accountsData-&gt;<a class="code" href="classAccountsData.html#a9">setREAccountId</a>(REAccountId);
00116     accountsData-&gt;<a class="code" href="classAccountsData.html#a10">setREAccountDesc</a>(REAccountDesc, <span class="keyword">false</span>);
00117 
00118     emit <a class="code" href="classClient.html#l0">clientOpened</a>(<a class="code" href="classClient.html#r5">clientName</a>);
00119 }
00120 
<a name="l00122"></a><a class="code" href="classClient.html#a3">00122</a> <span class="keywordtype">void</span> <a class="code" href="classClient.html#a3">Client::open</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> <span class="keywordtype">id</span>)
00123 {
00124     <a class="codeRef" doxygen="doxy-qt.tag:" href="qfile.html">QFile</a> file(<a class="code" href="classClient.html#r3">settings</a>-&gt;<a class="code" href="classSettings.html#a1">getClientPath</a>() + <span class="stringliteral">"/"</span> + <span class="keywordtype">id</span>);
00126     <span class="keywordflow">if</span>(!file.open(IO_ReadOnly))
00127     {
00128         <span class="keywordflow">return</span>;
00129     }
00130 
00131     <a class="codeRef" doxygen="doxy-qt.tag:" href="qdatastream.html">QDataStream</a> in(&amp;file);
00132     in.setVersion(5);
00133 
00134     Q_UINT32 magic;
00135     in &gt;&gt; magic;
00136     Q_UINT8 version;
00137     in &gt;&gt; version;
00139     <span class="keywordflow">if</span>(magic != (Q_UINT32)<a class="code" href="classClient.html#y2y0">MagicNumber</a> || version != (Q_UINT8)<a class="code" href="classClient.html#y3y1">Version</a>)
00140     {
00141         <span class="keywordflow">return</span>;
00142     }
00143 
00144     <a class="code" href="classClient.html#r4">clientId</a> = <span class="keywordtype">id</span>;
00145 
00146     Q_UINT16 accountCount;
00147     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> REAccountId;
00148     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> REAccountDesc;
00149     Q_UINT16 journalTmpCount;
00150     Q_UINT32 journalCount;
00151     Q_UINT16 editorEntityCount;
00152 
00153     in &gt;&gt; <a class="code" href="classClient.html#r5">clientName</a>
00154        &gt;&gt; <a class="code" href="classClient.html#r7">yearEndMonth</a>
00155        &gt;&gt; <a class="code" href="classClient.html#r8">creationDate</a>
00156        &gt;&gt; <a class="code" href="classClient.html#r9">modifiedDate</a>
00157        &gt;&gt; accountCount
00158        &gt;&gt; REAccountId
00159        &gt;&gt; REAccountDesc
00160        &gt;&gt; journalTmpCount
00161        &gt;&gt; journalCount
00162        &gt;&gt; editorEntityCount;
00163 
00164     in.unsetDevice();
00165 
00166     accountsData-&gt;<a class="code" href="classAccountsData.html#a2">readStream</a>(&amp;file, accountCount, REAccountId, REAccountDesc);
00167     journalData-&gt;<a class="code" href="classJournalData.html#a2">readStream</a>(&amp;file, journalTmpCount, journalCount);
00168     <a class="code" href="classClient.html#r2">reportsEditor</a>-&gt;<a class="code" href="classReportsEditor.html#a2">readStream</a>(&amp;file, editorEntityCount);
00169 
00170     file.close();
00171 
00172     <a class="code" href="classClient.html#r6">clientOpen</a> = <span class="keyword">true</span>;
00173 
00174     emit <a class="code" href="classClient.html#l0">clientOpened</a>(<a class="code" href="classClient.html#r5">clientName</a>);
00175 }
00176 
<a name="l00177"></a><a class="code" href="classClient.html#a4">00177</a> <span class="keywordtype">bool</span> <a class="code" href="classClient.html#a4">Client::isOpen</a>()
00178 {
00179     <span class="keywordflow">return</span> <a class="code" href="classClient.html#r6">clientOpen</a>;
00180 }
00181 
<a name="l00182"></a><a class="code" href="classClient.html#a5">00182</a> <span class="keywordtype">void</span> <a class="code" href="classClient.html#a5">Client::close</a>()
00183 {
00184     <span class="keywordflow">if</span>(!<a class="code" href="classClient.html#r6">clientOpen</a>)
00185         <span class="keywordflow">return</span>;
00186 
00187     <a class="code" href="classClient.html#r6">clientOpen</a> = <span class="keyword">false</span>;
00188 
00189     <a class="code" href="classClient.html#i0">saveToDisk</a>();
00190 
00191     accountsData-&gt;<a class="code" href="classAccountsData.html#a4">clearData</a>();
00192     journalData-&gt;<a class="code" href="classJournalData.html#a4">clearData</a>();
00193     <a class="code" href="classClient.html#r2">reportsEditor</a>-&gt;<a class="code" href="classReportsEditor.html#a4">clearData</a>();
00194 
00195     emit <a class="code" href="classClient.html#l1">clientClosed</a>(<a class="code" href="classClient.html#r5">clientName</a>);
00196 }
00197 
<a name="l00198"></a><a class="code" href="classClient.html#i0">00198</a> <span class="keywordtype">void</span> <a class="code" href="classClient.html#i0">Client::saveToDisk</a>()
00199 {
00200     <a class="codeRef" doxygen="doxy-qt.tag:" href="qfile.html">QFile</a> file(<a class="code" href="classClient.html#r3">settings</a>-&gt;<a class="code" href="classSettings.html#a1">getClientPath</a>() + <span class="stringliteral">"/"</span> + <a class="code" href="classClient.html#r4">clientId</a>);
00202     <span class="keywordflow">if</span>(!file.open(IO_WriteOnly))
00203         <span class="keywordflow">return</span>;
00204 
00205     Q_UINT16 accountCount = accountsData-&gt;<a class="code" href="classAccountsData.html#a17">getAccountCount</a>();
00206     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> REAccountId = accountsData-&gt;<a class="code" href="classAccountsData.html#a11">getREAccountId</a>();
00207     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> REAccountDesc = accountsData-&gt;<a class="code" href="classAccountsData.html#a12">getREAccountDesc</a>();
00208     Q_UINT16 journalTmpCount = journalData-&gt;<a class="code" href="classJournalData.html#a17">getJournalTmpCount</a>();
00209     Q_UINT32 journalCount = journalData-&gt;<a class="code" href="classJournalData.html#a18">getJournalCount</a>();
00210     Q_UINT16 editorEntityCount = <a class="code" href="classClient.html#r2">reportsEditor</a>-&gt;<a class="code" href="classReportsEditor.html#a5">getEditorEntityCount</a>();
00211 
00212     <a class="codeRef" doxygen="doxy-qt.tag:" href="qdatastream.html">QDataStream</a> out(&amp;file);
00213     out &lt;&lt; (Q_UINT32)<a class="code" href="classClient.html#y2y0">MagicNumber</a>
00214         &lt;&lt; (Q_UINT8)<a class="code" href="classClient.html#y3y1">Version</a>
00215         &lt;&lt; <a class="code" href="classClient.html#r5">clientName</a>
00216         &lt;&lt; <a class="code" href="classClient.html#r7">yearEndMonth</a>
00217         &lt;&lt; <a class="code" href="classClient.html#r8">creationDate</a>
00218         &lt;&lt; QDate::currentDate(Qt::UTC)
00219         &lt;&lt; accountCount
00220         &lt;&lt; REAccountId
00221         &lt;&lt; REAccountDesc
00222         &lt;&lt; journalTmpCount
00223         &lt;&lt; journalCount
00224         &lt;&lt; editorEntityCount;
00225 
00226     out.unsetDevice();
00227 
00228     accountsData-&gt;<a class="code" href="classAccountsData.html#a3">writeStream</a>(&amp;file);
00229     journalData-&gt;<a class="code" href="classJournalData.html#a3">writeStream</a>(&amp;file);
00230     <a class="code" href="classClient.html#r2">reportsEditor</a>-&gt;<a class="code" href="classReportsEditor.html#a3">writeStream</a>(&amp;file);
00231 
00232     file.close();
00233 }
00234 
<a name="l00235"></a><a class="code" href="classClient.html#a6">00235</a> <span class="keywordtype">void</span> <a class="code" href="classClient.html#a6">Client::setClientName</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> newClientName)
00236 {
00237     <a class="code" href="classClient.html#r5">clientName</a> = newClientName;
00238 
00239     emit <a class="code" href="classClient.html#l2">clientNameChanged</a>(<a class="code" href="classClient.html#r5">clientName</a>);
00240 }
00241 
<a name="l00242"></a><a class="code" href="classClient.html#a7">00242</a> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> <a class="code" href="classClient.html#a7">Client::getClientName</a>()<span class="keyword"> const</span>
00243 <span class="keyword"></span>{
00244     <span class="keywordflow">return</span> <a class="code" href="classClient.html#r5">clientName</a>;
00245 }
00246 
<a name="l00247"></a><a class="code" href="classClient.html#a8">00247</a> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstringlist.html">QStringList</a> <a class="code" href="classClient.html#a8">Client::getAllClients</a>()<span class="keyword"> const</span>
00248 <span class="keyword"></span>{
00249     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstringlist.html">QStringList</a> list;
00250 
00251     <a class="codeRef" doxygen="doxy-qt.tag:" href="qdir.html">QDir</a> dir(<a class="code" href="classClient.html#r3">settings</a>-&gt;<a class="code" href="classSettings.html#a1">getClientPath</a>());
00252     QStringList::Iterator it;
00253     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstringlist.html">QStringList</a> files = dir.entryList(<span class="stringliteral">"*.glc"</span>, QDir::Files);
00254     it = files.begin();
00255     <span class="keywordflow">while</span>(it != files.end())
00256     {
00257         <a class="codeRef" doxygen="doxy-qt.tag:" href="qfile.html">QFile</a> file(<a class="code" href="classClient.html#r3">settings</a>-&gt;<a class="code" href="classSettings.html#a1">getClientPath</a>() + <span class="stringliteral">"/"</span> + *it);
00258         <span class="keywordflow">if</span>(file.open(IO_ReadOnly))
00259         {
00260             <a class="codeRef" doxygen="doxy-qt.tag:" href="qdatastream.html">QDataStream</a> in(&amp;file);
00261             Q_UINT32 magic;
00262             in &gt;&gt; magic;
00263             Q_UINT8 version;
00264             in &gt;&gt; version;
00265             <span class="keywordflow">if</span>(magic == (Q_UINT32)<a class="code" href="classClient.html#y2y0">MagicNumber</a> &amp;&amp; version == (Q_UINT8)<a class="code" href="classClient.html#y3y1">Version</a>)
00266             {
00267                 <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> name;
00268                 in &gt;&gt; name;
00269                 list &lt;&lt; (name + <span class="stringliteral">"   ("</span> + *it + <span class="stringliteral">")"</span>);
00270             }
00271             file.close();
00272         }
00273         ++it;
00274     }
00275 
00276     <span class="keywordflow">return</span> list;
00277 }
00278 
<a name="l00279"></a><a class="code" href="classClient.html#a9">00279</a> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> <a class="code" href="classClient.html#a9">Client::defaultClientId</a>()<span class="keyword"> const</span>
00280 <span class="keyword"></span>{
00281     <span class="keywordflow">return</span> <a class="code" href="classClient.html#r4">clientId</a>;
00282 }
00283 
<a name="l00284"></a><a class="code" href="classClient.html#a10">00284</a> <span class="keywordtype">bool</span> <a class="code" href="classClient.html#a10">Client::defaultClientExists</a>()<span class="keyword"> const</span>
00285 <span class="keyword"></span>{
00286     <a class="codeRef" doxygen="doxy-qt.tag:" href="qfile.html">QFile</a> file(<a class="code" href="classClient.html#r3">settings</a>-&gt;<a class="code" href="classSettings.html#a1">getClientPath</a>() + <span class="stringliteral">"/"</span> + <a class="code" href="classClient.html#r4">clientId</a>);
00287     <span class="keywordflow">if</span>(file.exists())
00288     {
00289         <span class="keywordflow">if</span>(file.open(IO_ReadOnly))
00290         {
00291             <a class="codeRef" doxygen="doxy-qt.tag:" href="qdatastream.html">QDataStream</a> in(&amp;file);
00292             Q_UINT32 magic;
00293             in &gt;&gt; magic;
00294             <span class="keywordflow">if</span>(magic == (Q_UINT32)<a class="code" href="classClient.html#y2y0">MagicNumber</a>)
00295                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00296             file.close();
00297         }
00298     }
00299 
00300     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00301 }
00302 
<a name="l00303"></a><a class="code" href="classClient.html#a11">00303</a> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstringlist.html">QStringList</a> <a class="code" href="classClient.html#a11">Client::getPeriodList</a>(<span class="keywordtype">bool</span> begin)<span class="keyword"> const</span>
00304 <span class="keyword"></span>{
00305     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstringlist.html">QStringList</a> periods;
00306 
00307     <a class="codeRef" doxygen="doxy-qt.tag:" href="qdate.html">QDate</a> date;
00308     <span class="keywordtype">int</span> curYear = QDate::currentDate().year();
00309     <span class="keywordtype">int</span> curMonth = QDate::currentDate().month();
00310 
00311     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt;= 12; i++)
00312     {
00313         <span class="keywordflow">if</span>(<a class="code" href="classClient.html#r7">yearEndMonth</a> &gt; curMonth)
00314         {
00315             <span class="keywordflow">if</span>((<a class="code" href="classClient.html#r7">yearEndMonth</a> + i) &gt; 12)
00316                 date.setYMD(curYear, (i + <a class="code" href="classClient.html#r7">yearEndMonth</a> - 12), 1);
00317             <span class="keywordflow">else</span>
00318                 date.setYMD((curYear - 1), (i + yearEndMonth), 1);
00319         }
00320         <span class="keywordflow">else</span>
00321         {
00322             <span class="keywordflow">if</span>((<a class="code" href="classClient.html#r7">yearEndMonth</a> + i) &gt; 12)
00323                 date.setYMD((curYear + 1), (i + <a class="code" href="classClient.html#r7">yearEndMonth</a> - 12), 1);
00324             <span class="keywordflow">else</span>
00325                 date.setYMD(curYear, (i + yearEndMonth), 1);
00326         }
00327 
00328         <span class="keywordflow">if</span>(!begin)
00329             date = <a class="codeRef" doxygen="doxy-qt.tag:" href="qdate.html">QDate</a>(date.year(), date.month(), date.daysInMonth());
00330 
00331         periods &lt;&lt; (<span class="stringliteral">"Period "</span> + QString::number(i) + <span class="stringliteral">" ("</span> +
00332                     date.toString(Qt::LocalDate) + <span class="stringliteral">")"</span>);
00333     }
00334 
00335     <span class="keywordflow">return</span> periods;
00336 }
00337 
<a name="l00338"></a><a class="code" href="classClient.html#a12">00338</a> <a class="codeRef" doxygen="doxy-qt.tag:" href="qdate.html">QDate</a> <a class="code" href="classClient.html#a12">Client::getPeriodDate</a>(<span class="keywordtype">int</span> period, <span class="keywordtype">bool</span> endOfMonth)<span class="keyword"> const</span>
00339 <span class="keyword"></span>{
00340     <a class="codeRef" doxygen="doxy-qt.tag:" href="qdate.html">QDate</a> date;
00341     <span class="keywordtype">int</span> curYear = QDate::currentDate().year();
00342     <span class="keywordtype">int</span> curMonth = QDate::currentDate().month();
00343 
00344     <span class="keywordflow">if</span>(<a class="code" href="classClient.html#r7">yearEndMonth</a> &gt; curMonth)
00345     {
00346         <span class="keywordflow">if</span>((<a class="code" href="classClient.html#r7">yearEndMonth</a> + period) &gt; 12)
00347             date.setYMD(curYear, (period + <a class="code" href="classClient.html#r7">yearEndMonth</a> - 12), 1);
00348         <span class="keywordflow">else</span>
00349             date.setYMD((curYear - 1), (period + yearEndMonth), 1);
00350     }
00351     <span class="keywordflow">else</span>
00352     {
00353         <span class="keywordflow">if</span>((<a class="code" href="classClient.html#r7">yearEndMonth</a> + period) &gt; 12)
00354             date.setYMD((curYear + 1), (period + <a class="code" href="classClient.html#r7">yearEndMonth</a> - 12), 1);
00355         <span class="keywordflow">else</span>
00356             date.setYMD(curYear, (period + yearEndMonth), 1);
00357     }
00358 
00359     <span class="keywordflow">if</span>(endOfMonth)
00360         date = <a class="codeRef" doxygen="doxy-qt.tag:" href="qdate.html">QDate</a>(date.year(), date.month(), date.daysInMonth());
00361 
00362     <span class="keywordflow">return</span> date;
00363 }
00364 
<a name="l00365"></a><a class="code" href="classClient.html#a13">00365</a> <span class="keywordtype">int</span> <a class="code" href="classClient.html#a13">Client::getCurrentPeriod</a>()<span class="keyword"> const</span>
00366 <span class="keyword"></span>{
00367     <a class="codeRef" doxygen="doxy-qt.tag:" href="qdate.html">QDate</a> currentDate = QDate::currentDate();
00368     <span class="keywordtype">int</span> i;
00369     
00370     <span class="keywordflow">for</span>(i = 1; i &lt;= 12; i++)
00371     {
00372         <span class="keywordflow">if</span>(<a class="code" href="classClient.html#a12">getPeriodDate</a>(i, <span class="keyword">false</span>) &lt; currentDate
00373            &amp;&amp; <a class="code" href="classClient.html#a12">getPeriodDate</a>(i, <span class="keyword">true</span>) &gt; currentDate)
00374             <span class="keywordflow">break</span>;
00375     }
00376 
00377     <span class="keywordflow">return</span> i;
00378 }
00379 
00380 <span class="comment">// Private</span>
00381 
<a name="l00382"></a><a class="code" href="classClient.html#d0">00382</a> <a class="code" href="classClient.html#d0">Client::Client</a>() : <a class="codeRef" doxygen="doxy-qt.tag:" href="qobject.html">QObject</a>(0, "<a class="code" href="classClient.html">Client</a>")
00383 {}
00384 
<a name="l00385"></a><a class="code" href="classClient.html#d1">00385</a> <a class="code" href="classClient.html#d1">Client::~Client</a>()
00386 {
00387     <a class="code" href="classClient.html#a5">close</a>();
00388     
00389     <a class="code" href="classClient.html#r3">settings</a>-&gt;<a class="code" href="classSettings.html#a8">setDefaultClientId</a>(<a class="code" href="classClient.html#r4">clientId</a>);
00390     <a class="code" href="classClient.html#r3">settings</a>-&gt;<a class="code" href="classSettings.html#a10">setDefaultClientName</a>(<a class="code" href="classClient.html#r5">clientName</a>);
00391 }
00392 
00393 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Jan 16 16:23:27 2005 for General Ledger by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
