<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>General Ledger: accountsData.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>accountsData.cpp</h1><a href="accountsData_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/* General Ledger, Copyright (C) 2004  Joshua Eckroth &lt;josh@eckroth.net&gt;</span>
00002 <span class="comment"> * http://www.eckroth.net/software/genledg</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
00005 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment"> * (at your option) any later version.</span>
00008 <span class="comment"> * </span>
00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment"> * GNU General Public License for more details.</span>
00013 <span class="comment"> * </span>
00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
00015 <span class="comment"> * along with this program; if not, write to the Free Software</span>
00016 <span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  US</span>
00017 <span class="comment">*/</span>
00018 
00019 <span class="preprocessor">#include &lt;vector&gt;</span>
00020 <span class="keyword">using</span> std::vector;
00021 
00022 <span class="preprocessor">#include &lt;qobject.h&gt;</span>
00023 <span class="preprocessor">#include &lt;qstring.h&gt;</span>
00024 <span class="preprocessor">#include &lt;qstringlist.h&gt;</span>
00025 <span class="preprocessor">#include &lt;qiodevice.h&gt;</span>
00026 <span class="preprocessor">#include &lt;qdatastream.h&gt;</span>
00027 <span class="preprocessor">#include &lt;qtextstream.h&gt;</span>
00028 <span class="preprocessor">#include &lt;qregexp.h&gt;</span>
00029 
00030 <span class="preprocessor">#include "<a class="code" href="accountsData_8h.html">accountsData.h</a>"</span>
00031 <span class="preprocessor">#include "<a class="code" href="journalData_8h.html">journalData.h</a>"</span>
00032 
<a name="l00033"></a><a class="code" href="classAccountsData.html#v0">00033</a> <a class="code" href="classAccountsData.html">AccountsData</a> *<a class="code" href="classAccountsData.html#v0">AccountsData::thisInstance</a> = 0;
00034 
<a name="l00035"></a><a class="code" href="classAccountsData.html#e0">00035</a> <a class="code" href="classAccountsData.html">AccountsData</a>* <a class="code" href="classAccountsData.html#e0">AccountsData::instance</a>()
00036 {
00037     <span class="keywordflow">if</span>(<a class="code" href="classAccountsData.html#v0">thisInstance</a> == 0)
00038         <a class="code" href="classAccountsData.html#v0">thisInstance</a> = <span class="keyword">new</span> <a class="code" href="classAccountsData.html">AccountsData</a>;
00039     <span class="keywordflow">return</span> <a class="code" href="classAccountsData.html#v0">thisInstance</a>;
00040 }
00041 
<a name="l00042"></a><a class="code" href="classAccountsData.html#a0">00042</a> <span class="keywordtype">void</span> <a class="code" href="classAccountsData.html#a0">AccountsData::destroy</a>()
00043 {
00044     <span class="keywordflow">if</span>(<a class="code" href="classAccountsData.html#v0">thisInstance</a> != 0)
00045         <span class="keyword">delete</span> <a class="code" href="classAccountsData.html#v0">thisInstance</a>;
00046 }
00047 
<a name="l00048"></a><a class="code" href="classAccountsData.html#a1">00048</a> <span class="keywordtype">void</span> <a class="code" href="classAccountsData.html#a1">AccountsData::initiate</a>()
00049 {
00050     <a class="code" href="classAccountsData.html#r0">journalData</a> = <a class="code" href="classJournalData.html#e0">JournalData::instance</a>();
00051 }
00052 
<a name="l00053"></a><a class="code" href="classAccountsData.html#a2">00053</a> <span class="keywordtype">void</span> <a class="code" href="classAccountsData.html#a2">AccountsData::readStream</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qiodevice.html">QIODevice</a> *device, Q_UINT16 accountCount,
00054                 <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> newREAccountId, <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> newREAccountDesc)
00055 {
00056     <a class="codeRef" doxygen="doxy-qt.tag:" href="qdatastream.html">QDataStream</a> in(device);
00057 
00058     <a class="code" href="classAccountsData.html#r2">REAccount</a>-&gt;<a class="code" href="structAccountsData_1_1Account.html#o0">id</a> = newREAccountId;
00059     <a class="code" href="classAccountsData.html#r2">REAccount</a>-&gt;<a class="code" href="structAccountsData_1_1Account.html#o1">desc</a> = newREAccountDesc;
00060 
00061     Q_UINT16 i = 0;
00062     <span class="keywordflow">while</span>(i++ != accountCount)
00063     {
00064         <a class="code" href="structAccountsData_1_1Account.html">Account</a> *account = <span class="keyword">new</span> <a class="code" href="structAccountsData_1_1Account.html">Account</a>;
00065         in &gt;&gt; account-&gt;<a class="code" href="structAccountsData_1_1Account.html#o0">id</a>
00066            &gt;&gt; account-&gt;<a class="code" href="structAccountsData_1_1Account.html#o1">desc</a>;
00067         <a class="code" href="classAccountsData.html#r1">accountsVec</a>.push_back(account);
00068     }
00069 }
00070 
<a name="l00071"></a><a class="code" href="classAccountsData.html#a3">00071</a> <span class="keywordtype">void</span> <a class="code" href="classAccountsData.html#a3">AccountsData::writeStream</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qiodevice.html">QIODevice</a> *device)
00072 {
00073     <a class="codeRef" doxygen="doxy-qt.tag:" href="qdatastream.html">QDataStream</a> out(device);
00074 
00075     <span class="keywordflow">for</span>(vector&lt;Account*&gt;::const_iterator it = <a class="code" href="classAccountsData.html#r1">accountsVec</a>.begin();
00076                     it != <a class="code" href="classAccountsData.html#r1">accountsVec</a>.end(); ++it)
00077     {
00078         <span class="keywordflow">if</span>((*it) != 0)
00079         {
00080             out &lt;&lt; (*it)-&gt;id
00081                 &lt;&lt; (*it)-&gt;desc;
00082         }
00083     }
00084 }
00085 
<a name="l00086"></a><a class="code" href="classAccountsData.html#a4">00086</a> <span class="keywordtype">void</span> <a class="code" href="classAccountsData.html#a4">AccountsData::clearData</a>()
00087 {
00088     <span class="keywordflow">for</span>(vector&lt;Account*&gt;::iterator it = <a class="code" href="classAccountsData.html#r1">accountsVec</a>.begin();
00089         it != <a class="code" href="classAccountsData.html#r1">accountsVec</a>.end(); ++it)
00090     {
00091         <span class="keywordflow">if</span>((*it) != 0)
00092             <span class="keyword">delete</span> (*it);
00093     }
00094 
00095     <a class="code" href="classAccountsData.html#r1">accountsVec</a>.clear();
00096 }
00097 
<a name="l00098"></a><a class="code" href="classAccountsData.html#a17">00098</a> Q_UINT16 <a class="code" href="classAccountsData.html#a17">AccountsData::getAccountCount</a>()<span class="keyword"> const</span>
00099 <span class="keyword"></span>{
00100     Q_UINT16 count = 0;
00101     <span class="keywordflow">for</span>(vector&lt;Account*&gt;::const_iterator it = <a class="code" href="classAccountsData.html#r1">accountsVec</a>.begin();
00102                     it != <a class="code" href="classAccountsData.html#r1">accountsVec</a>.end(); ++it)
00103     {
00104         <span class="keywordflow">if</span>((*it) != 0)
00105             count++;
00106     }
00107 
00108     <span class="keywordflow">return</span> count;
00109 }
00110 
<a name="l00111"></a><a class="code" href="classAccountsData.html#a5">00111</a> vector&lt;AccountsData::Account*&gt; <a class="code" href="classAccountsData.html#a5">AccountsData::getAccounts</a>(
00112                 <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> accountBegin, <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> accountEnd,
00113                 <span class="keywordtype">bool</span> sorted, <span class="keywordtype">bool</span> addREAccount)<span class="keyword"> const</span>
00114 <span class="keyword"></span>{
00115     <span class="comment">// Prepare our new container</span>
00116     vector&lt;AccountsData::Account*&gt; accounts;
00117 
00118     <span class="comment">// Run through a very inefficient sorting process if requested</span>
00119     <span class="keywordflow">if</span>(sorted)
00120     {
00121         <span class="comment">// Add the retained earnings account if needed, and in our account range</span>
00122         <span class="keywordflow">if</span>(addREAccount &amp;&amp; ((accountBegin == <span class="stringliteral">""</span> &amp;&amp; accountEnd == <span class="stringliteral">""</span>) ||
00123                             ((QString::localeAwareCompare(<a class="code" href="classAccountsData.html#r2">REAccount</a>-&gt;<a class="code" href="structAccountsData_1_1Account.html#o0">id</a>,
00124                                              accountBegin) &gt;= 0)
00125                              &amp;&amp; (QString::localeAwareCompare(<a class="code" href="classAccountsData.html#r2">REAccount</a>-&gt;<a class="code" href="structAccountsData_1_1Account.html#o0">id</a>,
00126                                              accountEnd) &lt;= 0))))
00127             accounts.push_back(<a class="code" href="classAccountsData.html#r2">REAccount</a>);
00128 
00129         <span class="comment">// Look at every account</span>
00130         <span class="keywordflow">for</span>(vector&lt;AccountsData::Account*&gt;::const_iterator it =
00131             <a class="code" href="classAccountsData.html#r1">accountsVec</a>.begin(); it != <a class="code" href="classAccountsData.html#r1">accountsVec</a>.end(); ++it)
00132         {
00133             <span class="comment">// Go to the next account if the current one is not</span>
00134             <span class="comment">// in the accountBegin and accountEnd range; note that all</span>
00135             <span class="comment">// the following tests are in the form of negations</span>
00136             <span class="keywordflow">if</span>(accountBegin != <span class="stringliteral">""</span> &amp;&amp; accountEnd != <span class="stringliteral">""</span>
00137                &amp;&amp; ((QString::localeAwareCompare((*it)-&gt;id, accountBegin) &lt; 0)
00138                    || (QString::localeAwareCompare((*it)-&gt;id, accountEnd) &gt; 0)))
00139                 <span class="keywordflow">continue</span>;
00140 
00141             <span class="comment">// Keep track of whether the account has been inserted</span>
00142             <span class="keywordtype">bool</span> inserted = <span class="keyword">false</span>;
00143 
00144             <span class="comment">// Iterate over the whole accounts vector</span>
00145             <span class="keywordflow">for</span>(vector&lt;AccountsData::Account*&gt;::iterator innerIt =
00146                 accounts.begin(); innerIt != accounts.end(); ++innerIt)
00147             {
00148                 <span class="comment">// If the account id in the old vector is less than</span>
00149                 <span class="comment">// the account id in the new (sorted) vector, insert it</span>
00150                 <span class="comment">// at the present position</span>
00151                 <span class="keywordflow">if</span>(QString::localeAwareCompare((*it)-&gt;id, (*innerIt)-&gt;id) &lt; 0)
00152                 {
00153                     accounts.insert(innerIt, *it);
00154 
00155                     <span class="comment">// We've inserted it, so change the flag and quit</span>
00156                     inserted = <span class="keyword">true</span>;
00157                     <span class="keywordflow">break</span>;
00158                 }
00159             }
00160             <span class="comment">// If it was never inserted (the id is greater than</span>
00161             <span class="comment">// all the id's in the sorted accounts vector)</span>
00162             <span class="keywordflow">if</span>(!inserted)
00163                 accounts.push_back(*it);
00164         }
00165     }
00166     <span class="comment">// If we don't need to sort, just throw back the old accounts vector</span>
00167     <span class="keywordflow">else</span>
00168     {
00169         accounts = <a class="code" href="classAccountsData.html#r1">accountsVec</a>;
00170 
00171         <span class="comment">// Add the retained earnings account if needed</span>
00172         <span class="keywordflow">if</span>(addREAccount)
00173             accounts.push_back(<a class="code" href="classAccountsData.html#r2">REAccount</a>);
00174     }
00175 
00176     <span class="keywordflow">return</span> accounts;
00177 }
00178 
<a name="l00179"></a><a class="code" href="classAccountsData.html#a15">00179</a> <span class="keywordtype">bool</span> <a class="code" href="classAccountsData.html#a15">AccountsData::accountHasEntries</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> <span class="keywordtype">id</span>)<span class="keyword"> const</span>
00180 <span class="keyword"></span>{
00181     <span class="keywordflow">return</span> <a class="code" href="classAccountsData.html#r0">journalData</a>-&gt;<a class="code" href="classJournalData.html#a16">accountHasEntries</a>(<span class="keywordtype">id</span>);
00182 }
00183 
<a name="l00184"></a><a class="code" href="classAccountsData.html#a16">00184</a> <span class="keywordtype">bool</span> <a class="code" href="classAccountsData.html#a16">AccountsData::accountIdExists</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> <span class="keywordtype">id</span>)<span class="keyword"> const</span>
00185 <span class="keyword"></span>{
00186     <span class="keywordflow">if</span>(<span class="keywordtype">id</span> == <a class="code" href="classAccountsData.html#r2">REAccount</a>-&gt;<a class="code" href="structAccountsData_1_1Account.html#o0">id</a>)
00187         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00188 
00189     <span class="keywordflow">for</span>(vector&lt;Account*&gt;::const_iterator it = <a class="code" href="classAccountsData.html#r1">accountsVec</a>.begin();
00190                     it != <a class="code" href="classAccountsData.html#r1">accountsVec</a>.end(); ++it)
00191     {
00192         <span class="keywordflow">if</span>((*it) != 0)
00193         {
00194             <span class="keywordflow">if</span>((*it)-&gt;id == <span class="keywordtype">id</span>)
00195                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00196         }
00197     }
00198 
00199     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00200 }
00201 
<a name="l00202"></a><a class="code" href="classAccountsData.html#a6">00202</a> <span class="keywordtype">void</span> <a class="code" href="classAccountsData.html#a6">AccountsData::updateAccount</a>(Q_UINT16 key, <span class="keyword">const</span> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> <span class="keywordtype">id</span>,
00203                 <span class="keyword">const</span> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> desc)
00204 {
00205     <span class="keywordflow">if</span>((Q_UINT16)<a class="code" href="classAccountsData.html#r1">accountsVec</a>.size() &lt; key)  <span class="comment">// add a new entry</span>
00206     {
00207         <a class="code" href="structAccountsData_1_1Account.html">Account</a> *account = <span class="keyword">new</span> <a class="code" href="structAccountsData_1_1Account.html">Account</a>;
00208         account-&gt;<a class="code" href="structAccountsData_1_1Account.html#o0">id</a> = <span class="keywordtype">id</span>;
00209         account-&gt;<a class="code" href="structAccountsData_1_1Account.html#o1">desc</a> = desc;
00210         <a class="code" href="classAccountsData.html#r1">accountsVec</a>.push_back(account);
00211     }
00212     <span class="keywordflow">else</span>  <span class="comment">// update existing entry</span>
00213     {
00214         <a class="code" href="structAccountsData_1_1Account.html">Account</a> *account = <a class="code" href="classAccountsData.html#r1">accountsVec</a>[key-1];
00215         account-&gt;<a class="code" href="structAccountsData_1_1Account.html#o0">id</a> = <span class="keywordtype">id</span>;
00216         account-&gt;<a class="code" href="structAccountsData_1_1Account.html#o1">desc</a> = desc;
00217     }
00218 
00219     emit <a class="code" href="classAccountsData.html#l1">saveToDisk</a>();
00220 
00221     emit <a class="code" href="classAccountsData.html#l0">accountsChanged</a>();
00222 }
00223 
<a name="l00224"></a><a class="code" href="classAccountsData.html#a7">00224</a> <span class="keywordtype">void</span> <a class="code" href="classAccountsData.html#a7">AccountsData::deleteAccount</a>(<span class="keyword">const</span> Q_UINT16 key)
00225 {
00226     <span class="keyword">delete</span> <a class="code" href="classAccountsData.html#r1">accountsVec</a>[key-1];
00227     <a class="code" href="classAccountsData.html#r1">accountsVec</a>[key-1] = 0;
00228 
00229     emit <a class="code" href="classAccountsData.html#l1">saveToDisk</a>();
00230 
00231     emit <a class="code" href="classAccountsData.html#l0">accountsChanged</a>();
00232 }
00233 
<a name="l00234"></a><a class="code" href="classAccountsData.html#a8">00234</a> Q_UINT16 <a class="code" href="classAccountsData.html#a8">AccountsData::getNextAccountKey</a>()<span class="keyword"> const</span>
00235 <span class="keyword"></span>{
00236     <span class="keywordflow">return</span> (<a class="code" href="classAccountsData.html#r1">accountsVec</a>.size() + 1);
00237 }
00238 
<a name="l00239"></a><a class="code" href="classAccountsData.html#a9">00239</a> <span class="keywordtype">void</span> <a class="code" href="classAccountsData.html#a9">AccountsData::setREAccountId</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> newREAccountId)
00240 {
00241     <a class="code" href="classAccountsData.html#r2">REAccount</a>-&gt;<a class="code" href="structAccountsData_1_1Account.html#o0">id</a> = newREAccountId;
00242 }
00243 
<a name="l00244"></a><a class="code" href="classAccountsData.html#a10">00244</a> <span class="keywordtype">void</span> <a class="code" href="classAccountsData.html#a10">AccountsData::setREAccountDesc</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> newREAccountDesc,
00245                                     <span class="keywordtype">bool</span> emitSave)
00246 {
00247     <a class="code" href="classAccountsData.html#r2">REAccount</a>-&gt;<a class="code" href="structAccountsData_1_1Account.html#o1">desc</a> = newREAccountDesc;
00248 
00249     <span class="keywordflow">if</span>(emitSave)
00250         emit <a class="code" href="classAccountsData.html#l1">saveToDisk</a>();
00251 
00252     emit <a class="code" href="classAccountsData.html#l0">accountsChanged</a>();
00253 }
00254 
<a name="l00255"></a><a class="code" href="classAccountsData.html#a11">00255</a> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> <a class="code" href="classAccountsData.html#a11">AccountsData::getREAccountId</a>()<span class="keyword"> const</span>
00256 <span class="keyword"></span>{
00257     <span class="keywordflow">return</span> <a class="code" href="classAccountsData.html#r2">REAccount</a>-&gt;<a class="code" href="structAccountsData_1_1Account.html#o0">id</a>;
00258 }
00259 
<a name="l00260"></a><a class="code" href="classAccountsData.html#a12">00260</a> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> <a class="code" href="classAccountsData.html#a12">AccountsData::getREAccountDesc</a>()<span class="keyword"> const</span>
00261 <span class="keyword"></span>{
00262     <span class="keywordflow">return</span> <a class="code" href="classAccountsData.html#r2">REAccount</a>-&gt;<a class="code" href="structAccountsData_1_1Account.html#o1">desc</a>;
00263 }
00264 
<a name="l00265"></a><a class="code" href="classAccountsData.html#a13">00265</a> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstringlist.html">QStringList</a> <a class="code" href="classAccountsData.html#a13">AccountsData::getFormattedList</a>(<span class="keywordtype">bool</span> withREAccount)<span class="keyword"> const</span>
00266 <span class="keyword"></span>{
00267     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstringlist.html">QStringList</a> formattedList;
00268 
00269     <span class="keywordflow">for</span>(vector&lt;Account*&gt;::const_iterator it = <a class="code" href="classAccountsData.html#r1">accountsVec</a>.begin();
00270                     it != <a class="code" href="classAccountsData.html#r1">accountsVec</a>.end(); ++it)
00271     {
00272         <span class="keywordflow">if</span>((*it) != 0)
00273             formattedList &lt;&lt; ((*it)-&gt;id + <span class="stringliteral">" - "</span> + (*it)-&gt;desc);
00274     }
00275 
00276     <span class="keywordflow">if</span>(withREAccount)
00277     {
00278         formattedList &lt;&lt; (<a class="code" href="classAccountsData.html#r2">REAccount</a>-&gt;<a class="code" href="structAccountsData_1_1Account.html#o0">id</a> + <span class="stringliteral">" - "</span> + <a class="code" href="classAccountsData.html#r2">REAccount</a>-&gt;<a class="code" href="structAccountsData_1_1Account.html#o1">desc</a>);
00279     }
00280 
00281     formattedList.sort();
00282 
00283     <span class="keywordflow">return</span> formattedList;
00284 }
00285 
<a name="l00286"></a><a class="code" href="classAccountsData.html#a14">00286</a> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> <a class="code" href="classAccountsData.html#a14">AccountsData::getDescription</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> <span class="keywordtype">id</span>)<span class="keyword"> const</span>
00287 <span class="keyword"></span>{
00288     <span class="keywordflow">if</span>(<span class="keywordtype">id</span> == <a class="code" href="classAccountsData.html#r2">REAccount</a>-&gt;<a class="code" href="structAccountsData_1_1Account.html#o0">id</a>)
00289         <span class="keywordflow">return</span> <a class="code" href="classAccountsData.html#r2">REAccount</a>-&gt;<a class="code" href="structAccountsData_1_1Account.html#o1">desc</a>;
00290 
00291     <span class="keywordflow">for</span>(vector&lt;Account*&gt;::const_iterator it =
00292         <a class="code" href="classAccountsData.html#r1">accountsVec</a>.begin(); it != <a class="code" href="classAccountsData.html#r1">accountsVec</a>.end(); ++it)
00293     {
00294         <span class="keywordflow">if</span>((*it) != 0)
00295         {
00296             <span class="keywordflow">if</span>((*it)-&gt;id == <span class="keywordtype">id</span>)
00297                 <span class="keywordflow">return</span> (*it)-&gt;desc;
00298         }
00299     }
00300 
00301     <span class="keywordflow">return</span> QString::null;
00302 }
00303 
<a name="l00304"></a><a class="code" href="classAccountsData.html#a18">00304</a> <span class="keywordtype">void</span> <a class="code" href="classAccountsData.html#a18">AccountsData::importCSV</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qtextstream.html">QTextStream</a> &amp;in)
00305 {
00306     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> line;
00307     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> <span class="keywordtype">id</span>;
00308     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> desc;
00309 
00310     <a class="codeRef" doxygen="doxy-qt.tag:" href="qregexp.html">QRegExp</a> regExp(<span class="stringliteral">"^\\d+-?\\d*,.*"</span>);
00311 
00312     <span class="keywordflow">while</span>(line = in.readLine())
00313     {
00314         <span class="keywordflow">if</span>(!regExp.exactMatch(line))
00315             <span class="keywordflow">continue</span>;
00316 
00317         <span class="keywordtype">id</span> = line.left(line.find(<span class="stringliteral">","</span>));
00318         <span class="keywordflow">if</span>(<span class="keywordtype">id</span>.left(1) == <span class="stringliteral">"\""</span> &amp;&amp; <span class="keywordtype">id</span>.right(1) == <span class="stringliteral">"\""</span>)
00319             <span class="keywordtype">id</span> = <span class="keywordtype">id</span>.mid(1, <span class="keywordtype">id</span>.length() - 2);
00320 
00321         desc = line.mid(line.find(<span class="stringliteral">","</span>) + 1, line.length() - 1);
00322         <span class="keywordflow">if</span>(desc.left(1) == <span class="stringliteral">"\""</span> &amp;&amp; desc.right(1) == <span class="stringliteral">"\""</span>)
00323             desc = desc.mid(1, desc.length() - 2);
00324 
00325         <span class="keywordflow">if</span>(!<a class="code" href="classAccountsData.html#a16">accountIdExists</a>(<span class="keywordtype">id</span>))
00326         {
00327             <a class="code" href="structAccountsData_1_1Account.html">Account</a> *account = <span class="keyword">new</span> <a class="code" href="structAccountsData_1_1Account.html">Account</a>;
00328             account-&gt;<a class="code" href="structAccountsData_1_1Account.html#o0">id</a> = <span class="keywordtype">id</span>;
00329             account-&gt;<a class="code" href="structAccountsData_1_1Account.html#o1">desc</a> = desc;
00330 
00331             <a class="code" href="classAccountsData.html#r1">accountsVec</a>.push_back(account);
00332         }
00333     }
00334 
00335     emit <a class="code" href="classAccountsData.html#l1">saveToDisk</a>();
00336 
00337     emit <a class="code" href="classAccountsData.html#l0">accountsChanged</a>();
00338 }
00339 
<a name="l00340"></a><a class="code" href="classAccountsData.html#a19">00340</a> <span class="keywordtype">void</span> <a class="code" href="classAccountsData.html#a19">AccountsData::exportCSV</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qtextstream.html">QTextStream</a> &amp;out)
00341 {
00342     out &lt;&lt; <span class="stringliteral">"\"Account ID\",\"Account Description\"\n"</span>;
00343 
00344     vector&lt;Account*&gt; accountsSorted = <a class="code" href="classAccountsData.html#a5">getAccounts</a>(<span class="stringliteral">""</span>, <span class="stringliteral">""</span>, <span class="keyword">true</span>, <span class="keyword">true</span>);
00345 
00346     <span class="keywordflow">for</span>(vector&lt;Account*&gt;::const_iterator it = accountsSorted.begin();
00347         it != accountsSorted.end(); ++it)
00348     {
00349         out &lt;&lt; <span class="stringliteral">"\""</span> &lt;&lt; (*it)-&gt;id &lt;&lt; <span class="stringliteral">"\",\""</span> &lt;&lt; (*it)-&gt;desc &lt;&lt; <span class="stringliteral">"\"\n"</span>;
00350     }
00351 }
00352 
00353 <span class="comment">// Private</span>
00354 
<a name="l00355"></a><a class="code" href="classAccountsData.html#d0">00355</a> <a class="code" href="classAccountsData.html#d0">AccountsData::AccountsData</a>() : <a class="codeRef" doxygen="doxy-qt.tag:" href="qobject.html">QObject</a>(0, "<a class="code" href="classAccountsData.html">AccountsData</a>")
00356 {
00357     <a class="code" href="classAccountsData.html#r2">REAccount</a> = <span class="keyword">new</span> <a class="code" href="structAccountsData_1_1Account.html">Account</a>;
00358     <a class="code" href="classAccountsData.html#r2">REAccount</a>-&gt;<a class="code" href="structAccountsData_1_1Account.html#o0">id</a> = <span class="stringliteral">""</span>;
00359     <a class="code" href="classAccountsData.html#r2">REAccount</a>-&gt;<a class="code" href="structAccountsData_1_1Account.html#o1">desc</a> = <span class="stringliteral">""</span>;
00360 }
00361 
<a name="l00362"></a><a class="code" href="classAccountsData.html#d1">00362</a> <a class="code" href="classAccountsData.html#d1">AccountsData::~AccountsData</a>()
00363 {
00364     <span class="keyword">delete</span> <a class="code" href="classAccountsData.html#r2">REAccount</a>;
00365 }
00366 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Jan 16 16:23:27 2005 for General Ledger by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
