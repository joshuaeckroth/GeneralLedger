<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>General Ledger: globalTabs.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>globalTabs.cpp</h1><a href="globalTabs_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/* General Ledger, Copyright (C) 2004  Joshua Eckroth &lt;josh@eckroth.net&gt;</span>
00002 <span class="comment"> * http://www.eckroth.net/software/genledg</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
00005 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment"> * (at your option) any later version.</span>
00008 <span class="comment"> * </span>
00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment"> * GNU General Public License for more details.</span>
00013 <span class="comment"> * </span>
00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
00015 <span class="comment"> * along with this program; if not, write to the Free Software</span>
00016 <span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  US</span>
00017 <span class="comment">*/</span>
00018 
00019 <span class="preprocessor">#include &lt;qapplication.h&gt;</span>
00020 <span class="preprocessor">#include &lt;qtabwidget.h&gt;</span>
00021 <span class="preprocessor">#include &lt;qstring.h&gt;</span>
00022 <span class="preprocessor">#include &lt;qevent.h&gt;</span>
00023 
00024 <span class="preprocessor">#include "<a class="code" href="globalTabs_8h.html">globalTabs.h</a>"</span>
00025 <span class="preprocessor">#include "<a class="code" href="homeTab_8h.html">homeTab.h</a>"</span>
00026 <span class="preprocessor">#include "<a class="code" href="accountsTab_8h.html">accountsTab.h</a>"</span>
00027 <span class="preprocessor">#include "<a class="code" href="journalTab_8h.html">journalTab.h</a>"</span>
00028 <span class="preprocessor">#include "<a class="code" href="reportsTab_8h.html">reportsTab.h</a>"</span>
00029 <span class="preprocessor">#include "<a class="code" href="helpTab_8h.html">helpTab.h</a>"</span>
00030 <span class="preprocessor">#include "<a class="code" href="settings_8h.html">settings.h</a>"</span>
00031 <span class="preprocessor">#include "<a class="code" href="client_8h.html">client.h</a>"</span>
00032 <span class="preprocessor">#include "config.h"</span>
00033 
<a name="l00034"></a><a class="code" href="classGlobalTabs.html#a0">00034</a> <a class="code" href="classGlobalTabs.html#a0">GlobalTabs::GlobalTabs</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name)
00035     : <a class="codeRef" doxygen="doxy-qt.tag:" href="qtabwidget.html">QTabWidget</a>(0, name)
00036 {
00037     client = <a class="code" href="classClient.html#e0">Client::instance</a>();
00038     settings = <a class="code" href="classSettings.html#e0">Settings::instance</a>();
00039 
00040     <span class="comment">// Connect clientOpened and clientClosed signals (from the Client instance)</span>
00041     <span class="comment">// so that we enable and disable tabs at the right times.</span>
00042     connect(client, SIGNAL(<a class="code" href="classGlobalTabs.html#k0">clientOpened</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a>)), <span class="keyword">this</span>, SLOT(<a class="code" href="classGlobalTabs.html#k0">clientOpened</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a>)));
00043     connect(client, SIGNAL(<a class="code" href="classGlobalTabs.html#k1">clientClosed</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a>)), <span class="keyword">this</span>, SLOT(<a class="code" href="classGlobalTabs.html#k1">clientClosed</a>()));
00044 
00045     <span class="comment">// Do not let the keyboard get focus on our tabs</span>
00046     setFocusPolicy(QWidget::NoFocus);
00047 
00048     <span class="comment">// Set first caption; is changed via clientOpened and Closed signals from Client</span>
00049     <span class="comment">// or from clientNameChanged</span>
00050     setCaption(<span class="stringliteral">"General Ledger"</span>);
00051     connect(client, SIGNAL(<a class="code" href="classGlobalTabs.html#k2">clientNameChanged</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a>)), <span class="keyword">this</span>, SLOT(<a class="code" href="classGlobalTabs.html#k2">clientNameChanged</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a>)));
00052 
00053     <span class="comment">// The first tab; contains the menu interface.</span>
00054     <span class="comment">// It emits lots of signals for changing tabs, closing, etc.</span>
00055     <a class="code" href="classGlobalTabs.html#r2">homeTab</a> = <span class="keyword">new</span> <a class="code" href="classHomeTab.html">HomeTab</a>(<span class="keyword">this</span>, <span class="stringliteral">"globalTabs::homeTab"</span>);
00056     connect(<a class="code" href="classGlobalTabs.html#r2">homeTab</a>, SIGNAL(<a class="code" href="classGlobalTabs.html#k4">switchToAccounts</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="classGlobalTabs.html#k4">switchToAccounts</a>()));
00057     connect(<a class="code" href="classGlobalTabs.html#r2">homeTab</a>, SIGNAL(<a class="code" href="classGlobalTabs.html#k5">switchToJournal</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="classGlobalTabs.html#k5">switchToJournal</a>()));
00058     connect(<a class="code" href="classGlobalTabs.html#r2">homeTab</a>, SIGNAL(<a class="code" href="classGlobalTabs.html#k6">switchToReports</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="classGlobalTabs.html#k6">switchToReports</a>()));
00059     connect(<a class="code" href="classGlobalTabs.html#r2">homeTab</a>, SIGNAL(<a class="code" href="classGlobalTabs.html#k8">quit</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="classGlobalTabs.html#k8">quit</a>()));
00060 
00061     <span class="comment">// The Accounts tab.</span>
00062     <span class="comment">// Emits tab-switching signals since the table it contains intercepts</span>
00063     <span class="comment">// F# keys, which should switch tabs.</span>
00064     <a class="code" href="classGlobalTabs.html#r3">accountsTab</a> = <span class="keyword">new</span> <a class="code" href="classAccountsTab.html">AccountsTab</a>(<span class="keyword">this</span>, <span class="stringliteral">"globalTabs::accountsTab"</span>);
00065     connect(<a class="code" href="classGlobalTabs.html#r3">accountsTab</a>, SIGNAL(<a class="code" href="classGlobalTabs.html#k3">switchToHome</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="classGlobalTabs.html#k3">switchToHome</a>()));
00066     connect(<a class="code" href="classGlobalTabs.html#r3">accountsTab</a>, SIGNAL(<a class="code" href="classGlobalTabs.html#k5">switchToJournal</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="classGlobalTabs.html#k5">switchToJournal</a>()));
00067     connect(<a class="code" href="classGlobalTabs.html#r3">accountsTab</a>, SIGNAL(<a class="code" href="classGlobalTabs.html#k6">switchToReports</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="classGlobalTabs.html#k6">switchToReports</a>()));
00068     connect(<a class="code" href="classGlobalTabs.html#r3">accountsTab</a>, SIGNAL(<a class="code" href="classGlobalTabs.html#k7">switchToHelp</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="classGlobalTabs.html#k7">switchToHelp</a>()));
00069 
00070     <span class="comment">// The Journal tab.</span>
00071     <span class="comment">// Emits tab-switching signals since the table it contains intercepts</span>
00072     <span class="comment">// F# keys, which should switch tabs.</span>
00073     <a class="code" href="classGlobalTabs.html#r4">journalTab</a> = <span class="keyword">new</span> <a class="code" href="classJournalTab.html">JournalTab</a>(<span class="keyword">this</span>, <span class="stringliteral">"globalTabs::journalTab"</span>);
00074     connect(<a class="code" href="classGlobalTabs.html#r4">journalTab</a>, SIGNAL(<a class="code" href="classGlobalTabs.html#k3">switchToHome</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="classGlobalTabs.html#k3">switchToHome</a>()));
00075     connect(<a class="code" href="classGlobalTabs.html#r4">journalTab</a>, SIGNAL(<a class="code" href="classGlobalTabs.html#k4">switchToAccounts</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="classGlobalTabs.html#k4">switchToAccounts</a>()));
00076     connect(<a class="code" href="classGlobalTabs.html#r4">journalTab</a>, SIGNAL(<a class="code" href="classGlobalTabs.html#k6">switchToReports</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="classGlobalTabs.html#k6">switchToReports</a>()));
00077     connect(<a class="code" href="classGlobalTabs.html#r4">journalTab</a>, SIGNAL(<a class="code" href="classGlobalTabs.html#k7">switchToHelp</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="classGlobalTabs.html#k7">switchToHelp</a>()));
00078 
00079     <span class="comment">// The Reports tab.</span>
00080     <span class="comment">// Only emits a switchToHome signal (upon ESC).</span>
00081     <a class="code" href="classGlobalTabs.html#r5">reportsTab</a> = <span class="keyword">new</span> <a class="code" href="classReportsTab.html">ReportsTab</a>(<span class="keyword">this</span>, <span class="stringliteral">"globalTabs::reportsTab"</span>);
00082     connect(<a class="code" href="classGlobalTabs.html#r5">reportsTab</a>, SIGNAL(<a class="code" href="classGlobalTabs.html#k3">switchToHome</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="classGlobalTabs.html#k3">switchToHome</a>()));
00083 
00084     <span class="comment">// The Help tab, which like homeTab, is always active.</span>
00085     <span class="comment">// Only emits a switchToHome signal (upon ESC).</span>
00086     <a class="code" href="classGlobalTabs.html#r6">helpTab</a> = <span class="keyword">new</span> <a class="code" href="classHelpTab.html">HelpTab</a>(<span class="keyword">this</span>, <span class="stringliteral">"globalTabs::helpTab"</span>);
00087     connect(<a class="code" href="classGlobalTabs.html#r6">helpTab</a>, SIGNAL(<a class="code" href="classGlobalTabs.html#k3">switchToHome</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="classGlobalTabs.html#k3">switchToHome</a>()));
00088     
00089     <span class="comment">// Add all our tabs but only enable homeTab and helpTab.</span>
00090     addTab( <a class="code" href="classGlobalTabs.html#r2">homeTab</a>, <a class="codeRef" doxygen="doxy-qt.tag:" href="qiconset.html">QIconSet</a>(
00091         QPixmap::fromMimeSource(ICON_PATH + <span class="stringliteral">"/homeTab.png"</span>) ), <span class="stringliteral">"Home (F1)"</span> );
00092     addTab( <a class="code" href="classGlobalTabs.html#r3">accountsTab</a>, <a class="codeRef" doxygen="doxy-qt.tag:" href="qiconset.html">QIconSet</a>(
00093         QPixmap::fromMimeSource(ICON_PATH + <span class="stringliteral">"/accountsTab.png"</span>) ), <span class="stringliteral">"Accounts (F2)"</span> );
00094     setTabEnabled(<a class="code" href="classGlobalTabs.html#r3">accountsTab</a>, 0);
00095     addTab( <a class="code" href="classGlobalTabs.html#r4">journalTab</a>, <a class="codeRef" doxygen="doxy-qt.tag:" href="qiconset.html">QIconSet</a>(
00096         QPixmap::fromMimeSource(ICON_PATH + <span class="stringliteral">"/journalTab.png"</span>) ), <span class="stringliteral">"Journal Entry (F3)"</span> );
00097     setTabEnabled(<a class="code" href="classGlobalTabs.html#r4">journalTab</a>, 0);
00098     addTab( <a class="code" href="classGlobalTabs.html#r5">reportsTab</a>, <a class="codeRef" doxygen="doxy-qt.tag:" href="qiconset.html">QIconSet</a>(
00099         QPixmap::fromMimeSource(ICON_PATH + <span class="stringliteral">"/reportsTab.png"</span>) ), <span class="stringliteral">"Reports (F4)"</span> );
00100     setTabEnabled(<a class="code" href="classGlobalTabs.html#r5">reportsTab</a>, 0);
00101     addTab( <a class="code" href="classGlobalTabs.html#r6">helpTab</a>, <a class="codeRef" doxygen="doxy-qt.tag:" href="qiconset.html">QIconSet</a>(
00102         QPixmap::fromMimeSource(ICON_PATH + <span class="stringliteral">"/helpTab.png"</span>) ), <span class="stringliteral">"Help (F5)"</span> );
00103 
00104     <span class="comment">// Size and position the window (we are the main widget).</span>
00105     <span class="comment">// Note that if the window was maximized, the all values are 10000.</span>
00106     <span class="keywordflow">if</span>(settings-&gt;<a class="code" href="classSettings.html#a15">getDefaultX</a>() == 10000 &amp;&amp; settings-&gt;<a class="code" href="classSettings.html#a17">getDefaultY</a>() == 10000 
00107        &amp;&amp; settings-&gt;<a class="code" href="classSettings.html#a11">getDefaultWidth</a>() == 10000 &amp;&amp; settings-&gt;<a class="code" href="classSettings.html#a13">getDefaultHeight</a>() == 10000)
00108         showMaximized();
00109     <span class="keywordflow">else</span>
00110     {
00111         move(settings-&gt;<a class="code" href="classSettings.html#a15">getDefaultX</a>(), settings-&gt;<a class="code" href="classSettings.html#a17">getDefaultY</a>());
00112         resize(settings-&gt;<a class="code" href="classSettings.html#a11">getDefaultWidth</a>(), settings-&gt;<a class="code" href="classSettings.html#a13">getDefaultHeight</a>());
00113     }
00114 }
00115 
<a name="l00118"></a><a class="code" href="classGlobalTabs.html#k0">00118</a> <span class="keywordtype">void</span> <a class="code" href="classGlobalTabs.html#k0">GlobalTabs::clientOpened</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> clientName)
00119 {
00120     setCaption(<span class="stringliteral">"General Ledger - "</span> + clientName);
00121 
00122     setTabEnabled(<a class="code" href="classGlobalTabs.html#r3">accountsTab</a>, <span class="keyword">true</span>);
00123     setTabEnabled(<a class="code" href="classGlobalTabs.html#r4">journalTab</a>, <span class="keyword">true</span>);
00124     setTabEnabled(<a class="code" href="classGlobalTabs.html#r5">reportsTab</a>, <span class="keyword">true</span>);
00125 }
00126 
<a name="l00129"></a><a class="code" href="classGlobalTabs.html#k1">00129</a> <span class="keywordtype">void</span> <a class="code" href="classGlobalTabs.html#k1">GlobalTabs::clientClosed</a>()
00130 {
00131     setCaption(<span class="stringliteral">"General Ledger"</span>);
00132 
00133     setTabEnabled(<a class="code" href="classGlobalTabs.html#r3">accountsTab</a>, <span class="keyword">false</span>);
00134     setTabEnabled(<a class="code" href="classGlobalTabs.html#r4">journalTab</a>, <span class="keyword">false</span>);
00135     setTabEnabled(<a class="code" href="classGlobalTabs.html#r5">reportsTab</a>, <span class="keyword">false</span>);
00136 }
00137 
<a name="l00140"></a><a class="code" href="classGlobalTabs.html#k2">00140</a> <span class="keywordtype">void</span> <a class="code" href="classGlobalTabs.html#k2">GlobalTabs::clientNameChanged</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> clientName)
00141 {
00142     setCaption(<span class="stringliteral">"General Ledger - "</span> + clientName);
00143 }
00144 
<a name="l00147"></a><a class="code" href="classGlobalTabs.html#k3">00147</a> <span class="keywordtype">void</span> <a class="code" href="classGlobalTabs.html#k3">GlobalTabs::switchToHome</a>()
00148 {
00149     showPage(<a class="code" href="classGlobalTabs.html#r2">homeTab</a>);
00150 }
00151 
<a name="l00154"></a><a class="code" href="classGlobalTabs.html#k4">00154</a> <span class="keywordtype">void</span> <a class="code" href="classGlobalTabs.html#k4">GlobalTabs::switchToAccounts</a>()
00155 {
00156     showPage(<a class="code" href="classGlobalTabs.html#r3">accountsTab</a>);
00157 }
00158 
<a name="l00161"></a><a class="code" href="classGlobalTabs.html#k5">00161</a> <span class="keywordtype">void</span> <a class="code" href="classGlobalTabs.html#k5">GlobalTabs::switchToJournal</a>()
00162 {
00163     showPage(<a class="code" href="classGlobalTabs.html#r4">journalTab</a>);
00164 }
00165 
<a name="l00168"></a><a class="code" href="classGlobalTabs.html#k6">00168</a> <span class="keywordtype">void</span> <a class="code" href="classGlobalTabs.html#k6">GlobalTabs::switchToReports</a>()
00169 {
00170     showPage(<a class="code" href="classGlobalTabs.html#r5">reportsTab</a>);
00171 }
00172 
<a name="l00175"></a><a class="code" href="classGlobalTabs.html#k7">00175</a> <span class="keywordtype">void</span> <a class="code" href="classGlobalTabs.html#k7">GlobalTabs::switchToHelp</a>()
00176 {
00177     showPage(<a class="code" href="classGlobalTabs.html#r6">helpTab</a>);
00178 }
00179 
<a name="l00182"></a><a class="code" href="classGlobalTabs.html#k8">00182</a> <span class="keywordtype">void</span> <a class="code" href="classGlobalTabs.html#k8">GlobalTabs::quit</a>()
00183 {
00184     <span class="comment">// Save normal layout settings when not maximized</span>
00185     <span class="keywordflow">if</span>(!isMaximized())
00186     {
00187         settings-&gt;<a class="code" href="classSettings.html#a16">setDefaultX</a>(x());
00188         settings-&gt;<a class="code" href="classSettings.html#a18">setDefaultY</a>(y());
00189         settings-&gt;<a class="code" href="classSettings.html#a12">setDefaultWidth</a>(width());
00190         settings-&gt;<a class="code" href="classSettings.html#a14">setDefaultHeight</a>(height());
00191     }
00192 
00193     <span class="comment">// Save bizarre layout settings when maximized</span>
00194     <span class="keywordflow">else</span>
00195     {
00196         settings-&gt;<a class="code" href="classSettings.html#a16">setDefaultX</a>(10000);
00197         settings-&gt;<a class="code" href="classSettings.html#a18">setDefaultY</a>(10000);
00198         settings-&gt;<a class="code" href="classSettings.html#a12">setDefaultWidth</a>(10000);
00199         settings-&gt;<a class="code" href="classSettings.html#a14">setDefaultHeight</a>(10000);
00200     }
00201    
00202     <span class="comment">// Finally quit </span>
00203     qApp-&gt;quit();
00204 }
00205 
<a name="l00206"></a><a class="code" href="classGlobalTabs.html#d0">00206</a> <span class="keywordtype">void</span> <a class="code" href="classGlobalTabs.html#d0">GlobalTabs::keyPressEvent</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qkeyevent.html">QKeyEvent</a> *event)
00207 {
00208     <span class="keywordflow">switch</span>(event-&gt;key())
00209     {
00210         <span class="keywordflow">case</span> Key_F1:
00211             showPage(<a class="code" href="classGlobalTabs.html#r2">homeTab</a>);
00212             <span class="keywordflow">break</span>;
00213         <span class="keywordflow">case</span> Key_F2:
00214             <span class="keywordflow">if</span>(isTabEnabled(<a class="code" href="classGlobalTabs.html#r3">accountsTab</a>))
00215                 showPage(<a class="code" href="classGlobalTabs.html#r3">accountsTab</a>);
00216             <span class="keywordflow">break</span>;
00217         <span class="keywordflow">case</span> Key_F3:
00218             <span class="keywordflow">if</span>(isTabEnabled(<a class="code" href="classGlobalTabs.html#r4">journalTab</a>))
00219                 showPage(<a class="code" href="classGlobalTabs.html#r4">journalTab</a>);
00220             <span class="keywordflow">break</span>;
00221         <span class="keywordflow">case</span> Key_F4:
00222             <span class="keywordflow">if</span>(isTabEnabled(<a class="code" href="classGlobalTabs.html#r5">reportsTab</a>))
00223                 showPage(<a class="code" href="classGlobalTabs.html#r5">reportsTab</a>);
00224             <span class="keywordflow">break</span>;
00225         <span class="keywordflow">case</span> Key_F5:
00226             showPage(<a class="code" href="classGlobalTabs.html#r6">helpTab</a>);
00227             <span class="keywordflow">break</span>;
00228     }
00229 }
00230 
<a name="l00231"></a><a class="code" href="classGlobalTabs.html#d1">00231</a> <span class="keywordtype">void</span> <a class="code" href="classGlobalTabs.html#d1">GlobalTabs::closeEvent</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qcloseevent.html">QCloseEvent</a> *event)
00232 {
00233     <a class="code" href="classGlobalTabs.html#r2">homeTab</a>-&gt;<a class="code" href="classHomeTab.html#i0">closeClient</a>();
00234 
00235     <span class="keywordflow">if</span>(!client-&gt;<a class="code" href="classClient.html#a4">isOpen</a>())
00236     {
00237         <span class="comment">// call our quit function (slot)</span>
00238         <a class="code" href="classGlobalTabs.html#k8">quit</a>();
00239         event-&gt;accept();
00240     }
00241     <span class="keywordflow">else</span>
00242     {
00243         <span class="comment">// An `else' would be the user wants to return to the journal</span>
00244         <span class="comment">// entries instead of closing.</span>
00245         event-&gt;ignore();
00246     }
00247 }
00248 
00249 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Jan 16 16:23:28 2005 for General Ledger by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
