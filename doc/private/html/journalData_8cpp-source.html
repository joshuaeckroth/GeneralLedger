<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>General Ledger: journalData.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>journalData.cpp</h1><a href="journalData_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/* General Ledger, Copyright (C) 2004  Joshua Eckroth &lt;josh@eckroth.net&gt;</span>
00002 <span class="comment"> * http://www.eckroth.net/software/genledg</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
00005 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment"> * (at your option) any later version.</span>
00008 <span class="comment"> * </span>
00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment"> * GNU General Public License for more details.</span>
00013 <span class="comment"> * </span>
00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
00015 <span class="comment"> * along with this program; if not, write to the Free Software</span>
00016 <span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  US</span>
00017 <span class="comment">*/</span>
00018 
00019 <span class="preprocessor">#include &lt;vector&gt;</span>
00020 <span class="keyword">using</span> std::vector;
00021 
00022 <span class="preprocessor">#include &lt;cmath&gt;</span>
00023 <span class="keyword">using</span> std::abs;
00024 
00025 <span class="preprocessor">#include &lt;qstring.h&gt;</span>
00026 <span class="preprocessor">#include &lt;qiodevice.h&gt;</span>
00027 <span class="preprocessor">#include &lt;qdatastream.h&gt;</span>
00028 <span class="preprocessor">#include &lt;qdatetime.h&gt;</span>
00029 <span class="preprocessor">#include &lt;qtextstream.h&gt;</span>
00030 <span class="preprocessor">#include &lt;qregexp.h&gt;</span>
00031 
00032 <span class="preprocessor">#include "<a class="code" href="journalData_8h.html">journalData.h</a>"</span>
00033 <span class="preprocessor">#include "<a class="code" href="main_8h.html">main.h</a>"</span>
00034 
<a name="l00035"></a><a class="code" href="classJournalData.html#v0">00035</a> <a class="code" href="classJournalData.html">JournalData</a> *<a class="code" href="classJournalData.html#v0">JournalData::thisInstance</a> = 0;
00036 
<a name="l00037"></a><a class="code" href="classJournalData.html#e0">00037</a> <a class="code" href="classJournalData.html">JournalData</a>* <a class="code" href="classJournalData.html#e0">JournalData::instance</a>()
00038 {
00039     <span class="keywordflow">if</span>(<a class="code" href="classJournalData.html#v0">thisInstance</a> == 0)
00040         <a class="code" href="classJournalData.html#v0">thisInstance</a> = <span class="keyword">new</span> <a class="code" href="classJournalData.html">JournalData</a>;
00041     <span class="keywordflow">return</span> <a class="code" href="classJournalData.html#v0">thisInstance</a>;
00042 }
00043 
<a name="l00044"></a><a class="code" href="classJournalData.html#a0">00044</a> <span class="keywordtype">void</span> <a class="code" href="classJournalData.html#a0">JournalData::destroy</a>()
00045 {
00046     <span class="keywordflow">if</span>(<a class="code" href="classJournalData.html#v0">thisInstance</a> != 0)
00047         <span class="keyword">delete</span> <a class="code" href="classJournalData.html#v0">thisInstance</a>;
00048 }
00049 
<a name="l00050"></a><a class="code" href="classJournalData.html#a1">00050</a> <span class="keywordtype">void</span> <a class="code" href="classJournalData.html#a1">JournalData::initiate</a>()
00051 {}
00052 
<a name="l00053"></a><a class="code" href="classJournalData.html#a2">00053</a> <span class="keywordtype">void</span> <a class="code" href="classJournalData.html#a2">JournalData::readStream</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qiodevice.html">QIODevice</a> *device, Q_UINT16 journalTmpCount,
00054                 Q_UINT32 journalCount)
00055 {
00056     <a class="codeRef" doxygen="doxy-qt.tag:" href="qdatastream.html">QDataStream</a> in(device);
00057 
00058     Q_UINT16 i = 0;
00059     <span class="keywordflow">while</span>(i++ != journalTmpCount)
00060     {
00061         <a class="code" href="structJournalData_1_1JournalRecord.html">JournalRecord</a> *journalTmpRecord = <span class="keyword">new</span> <a class="code" href="structJournalData_1_1JournalRecord.html">JournalRecord</a>;
00062         in &gt;&gt; journalTmpRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o0">date</a>
00063            &gt;&gt; journalTmpRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o1">account</a>
00064            &gt;&gt; journalTmpRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o2">reference</a>
00065            &gt;&gt; journalTmpRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o3">desc</a>
00066            &gt;&gt; journalTmpRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o4">amount</a>;
00067         <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.push_back(journalTmpRecord);
00068     }
00069 
00070     Q_UINT32 j = 0;
00071     <span class="keywordflow">while</span>(j++ != journalCount)
00072     {
00073         <a class="code" href="structJournalData_1_1JournalRecord.html">JournalRecord</a> *journalRecord = <span class="keyword">new</span> <a class="code" href="structJournalData_1_1JournalRecord.html">JournalRecord</a>;
00074         in &gt;&gt; journalRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o0">date</a>
00075            &gt;&gt; journalRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o1">account</a>
00076            &gt;&gt; journalRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o2">reference</a>
00077            &gt;&gt; journalRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o3">desc</a>
00078            &gt;&gt; journalRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o4">amount</a>;
00079         <a class="code" href="classJournalData.html#r1">journalVec</a>.push_back(journalRecord);
00080     }
00081 }
00082 
<a name="l00083"></a><a class="code" href="classJournalData.html#a3">00083</a> <span class="keywordtype">void</span> <a class="code" href="classJournalData.html#a3">JournalData::writeStream</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qiodevice.html">QIODevice</a> *device)
00084 {
00085     <a class="codeRef" doxygen="doxy-qt.tag:" href="qdatastream.html">QDataStream</a> out(device);
00086 
00087     <span class="keywordflow">for</span>(vector&lt;JournalRecord*&gt;::const_iterator it = <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.begin();
00088                     it != <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.end(); ++it)
00089     {
00090         <span class="keywordflow">if</span>((*it) != 0)
00091         {
00092             out &lt;&lt; (*it)-&gt;date
00093                 &lt;&lt; (*it)-&gt;account
00094                 &lt;&lt; (*it)-&gt;reference
00095                 &lt;&lt; (*it)-&gt;desc
00096                 &lt;&lt; (*it)-&gt;amount;
00097         }
00098     }
00099 
00100     <span class="keywordflow">for</span>(vector&lt;JournalRecord*&gt;::const_iterator it = <a class="code" href="classJournalData.html#r1">journalVec</a>.begin();
00101                     it != <a class="code" href="classJournalData.html#r1">journalVec</a>.end(); ++it)
00102     {
00103         <span class="keywordflow">if</span>((*it) != 0)
00104         {
00105             out &lt;&lt; (*it)-&gt;date
00106                 &lt;&lt; (*it)-&gt;account
00107                 &lt;&lt; (*it)-&gt;reference
00108                 &lt;&lt; (*it)-&gt;desc
00109                 &lt;&lt; (*it)-&gt;amount;
00110         }
00111     }
00112 }
00113 
<a name="l00114"></a><a class="code" href="classJournalData.html#a4">00114</a> <span class="keywordtype">void</span> <a class="code" href="classJournalData.html#a4">JournalData::clearData</a>()
00115 {
00116     <span class="keywordflow">for</span>(vector&lt;JournalRecord*&gt;::iterator it = <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.begin();
00117         it != <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.end(); ++it)
00118     {
00119         <span class="keywordflow">if</span>((*it) != 0)
00120             <span class="keyword">delete</span> (*it);
00121     }
00122 
00123     <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.clear();
00124 
00125     <span class="keywordflow">for</span>(vector&lt;JournalRecord*&gt;::iterator it = <a class="code" href="classJournalData.html#r1">journalVec</a>.begin();
00126         it != <a class="code" href="classJournalData.html#r1">journalVec</a>.end(); ++it)
00127     {
00128         <span class="keywordflow">if</span>((*it) != 0)
00129             <span class="keyword">delete</span> (*it);
00130     }
00131 
00132     <a class="code" href="classJournalData.html#r1">journalVec</a>.clear();
00133 }
00134 
<a name="l00135"></a><a class="code" href="classJournalData.html#a17">00135</a> Q_UINT16 <a class="code" href="classJournalData.html#a17">JournalData::getJournalTmpCount</a>()<span class="keyword"> const</span>
00136 <span class="keyword"></span>{
00137     Q_UINT16 count = 0;
00138 
00139     <span class="keywordflow">for</span>(vector&lt;JournalRecord*&gt;::const_iterator it = <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.begin();
00140                     it != <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.end(); ++it)
00141     {
00142         <span class="keywordflow">if</span>((*it) != 0)
00143             count++;
00144     }
00145 
00146     <span class="keywordflow">return</span> count;
00147 }
00148 
<a name="l00149"></a><a class="code" href="classJournalData.html#a18">00149</a> Q_UINT32 <a class="code" href="classJournalData.html#a18">JournalData::getJournalCount</a>()<span class="keyword"> const</span>
00150 <span class="keyword"></span>{
00151     Q_UINT32 count = 0;
00152 
00153     <span class="keywordflow">for</span>(vector&lt;JournalRecord*&gt;::const_iterator it = <a class="code" href="classJournalData.html#r1">journalVec</a>.begin();
00154                     it != <a class="code" href="classJournalData.html#r1">journalVec</a>.end(); ++it)
00155     {
00156         <span class="keywordflow">if</span>((*it) != 0)
00157             count++;
00158     }
00159 
00160     <span class="keywordflow">return</span> count;
00161 }
00162 
<a name="l00163"></a><a class="code" href="classJournalData.html#a5">00163</a> vector&lt;JournalData::JournalRecord*&gt; <a class="code" href="classJournalData.html#a5">JournalData::getJournalTmpRecords</a>()<span class="keyword"> const</span>
00164 <span class="keyword"></span>{
00165     <span class="keywordflow">return</span> <a class="code" href="classJournalData.html#r0">journalTmpVec</a>;
00166 }
00167 
<a name="l00168"></a><a class="code" href="classJournalData.html#a6">00168</a> vector&lt;JournalData::JournalRecord*&gt; <a class="code" href="classJournalData.html#a6">JournalData::getJournalRecords</a>(
00169                 <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> accountBegin, <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> accountEnd,
00170                 <a class="codeRef" doxygen="doxy-qt.tag:" href="qdate.html">QDate</a> periodBegin, <a class="codeRef" doxygen="doxy-qt.tag:" href="qdate.html">QDate</a> periodEnd, SortField sort)<span class="keyword"> const</span>
00171 <span class="keyword"></span>{
00172     vector&lt;JournalData::JournalRecord*&gt; journal;
00173 
00174     <span class="keywordflow">for</span>(vector&lt;JournalData::JournalRecord*&gt;::const_iterator it = <a class="code" href="classJournalData.html#r1">journalVec</a>.begin();
00175                     it != <a class="code" href="classJournalData.html#r1">journalVec</a>.end(); ++it)
00176     {
00177         <span class="keywordflow">if</span>(accountBegin != <span class="stringliteral">""</span> &amp;&amp; QString::localeAwareCompare(
00178             (*it)-&gt;account, accountBegin) &lt; 0)
00179             <span class="keywordflow">continue</span>;
00180         <span class="keywordflow">if</span>(accountEnd != <span class="stringliteral">""</span> &amp;&amp; QString::localeAwareCompare(
00181             (*it)-&gt;account, accountEnd) &gt; 0)
00182             <span class="keywordflow">continue</span>;
00183         <span class="keywordflow">if</span>(periodBegin.isValid() &amp;&amp; (*it)-&gt;date &lt; periodBegin)
00184             <span class="keywordflow">continue</span>;
00185         <span class="keywordflow">if</span>(periodEnd.isValid() &amp;&amp; (*it)-&gt;date &gt; periodEnd)
00186             <span class="keywordflow">continue</span>;
00187         
00188         <span class="keywordflow">if</span>(sort == <a class="code" href="classJournalData.html#w2w1">SortDate</a>)
00189         {
00190             <span class="keywordtype">bool</span> inserted = <span class="keyword">false</span>;
00191 
00192             <span class="keywordflow">for</span>(vector&lt;JournalData::JournalRecord*&gt;::iterator innerIt = journal.begin();
00193                             innerIt != journal.end(); ++innerIt)
00194             {
00195                 <span class="keywordflow">if</span>((*it)-&gt;date &lt; (*innerIt)-&gt;date)
00196                 {
00197                     journal.insert(innerIt, *it);
00198                     
00199                     inserted = <span class="keyword">true</span>;
00200                     <span class="keywordflow">break</span>;
00201                 }
00202             }
00203 
00204             <span class="keywordflow">if</span>(!inserted)
00205                 journal.push_back(*it);
00206         }
00207         <span class="keywordflow">if</span>(sort == <a class="code" href="classJournalData.html#w2w0">NoSort</a>)
00208             journal.push_back(*it);
00209     }
00210 
00211     <span class="keywordflow">return</span> journal;
00212 }
00213 
00214 
<a name="l00215"></a><a class="code" href="classJournalData.html#a7">00215</a> <span class="keywordtype">void</span> <a class="code" href="classJournalData.html#a7">JournalData::updateTmpRecord</a>(<span class="keyword">const</span> Q_UINT16 key, <span class="keyword">const</span> <a class="codeRef" doxygen="doxy-qt.tag:" href="qdate.html">QDate</a> date,
00216                 <span class="keyword">const</span> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> account, <span class="keyword">const</span> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> reference,
00217                 <span class="keyword">const</span> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> desc, <span class="keyword">const</span> Q_INT64 amount)
00218 {
00219     <span class="keywordflow">if</span>((Q_UINT16)<a class="code" href="classJournalData.html#r0">journalTmpVec</a>.size() &lt; key)  <span class="comment">// add a new entry</span>
00220     {
00221         <a class="code" href="structJournalData_1_1JournalRecord.html">JournalRecord</a> *journalTmpRecord = <span class="keyword">new</span> <a class="code" href="structJournalData_1_1JournalRecord.html">JournalRecord</a>;
00222         journalTmpRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o0">date</a> = date;
00223         journalTmpRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o1">account</a> = account;
00224         journalTmpRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o2">reference</a> = reference;
00225         journalTmpRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o3">desc</a> = desc;
00226         journalTmpRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o4">amount</a> = amount;
00227         <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.push_back(journalTmpRecord);
00228     }
00229     <span class="keywordflow">else</span>  <span class="comment">// update existing entry</span>
00230     {
00231         <a class="code" href="structJournalData_1_1JournalRecord.html">JournalRecord</a> *journalTmpRecord = <a class="code" href="classJournalData.html#r0">journalTmpVec</a>[key-1];
00232         journalTmpRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o0">date</a> = date;
00233         journalTmpRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o1">account</a> = account;
00234         journalTmpRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o2">reference</a> = reference;
00235         journalTmpRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o3">desc</a> = desc;
00236         journalTmpRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o4">amount</a> = amount;
00237     }
00238 
00239     emit <a class="code" href="classJournalData.html#l1">saveToDisk</a>();
00240 
00241     emit <a class="code" href="classJournalData.html#l0">journalTmpChanged</a>();
00242 }
00243 
<a name="l00244"></a><a class="code" href="classJournalData.html#a8">00244</a> <span class="keywordtype">void</span> <a class="code" href="classJournalData.html#a8">JournalData::deleteTmpRecord</a>(<span class="keyword">const</span> Q_UINT16 key)
00245 {
00246     <span class="keyword">delete</span> <a class="code" href="classJournalData.html#r0">journalTmpVec</a>[key-1];
00247     <a class="code" href="classJournalData.html#r0">journalTmpVec</a>[key-1] = 0;
00248 
00249     emit <a class="code" href="classJournalData.html#l1">saveToDisk</a>();
00250 
00251     emit <a class="code" href="classJournalData.html#l0">journalTmpChanged</a>();
00252 }
00253 
<a name="l00254"></a><a class="code" href="classJournalData.html#a9">00254</a> Q_UINT16 <a class="code" href="classJournalData.html#a9">JournalData::getNextTmpRecordKey</a>()<span class="keyword"> const</span>
00255 <span class="keyword"></span>{
00256     <span class="keywordflow">return</span> (<a class="code" href="classJournalData.html#r0">journalTmpVec</a>.size() + 1);
00257 }
00258 
<a name="l00259"></a><a class="code" href="classJournalData.html#a10">00259</a> <span class="keywordtype">void</span> <a class="code" href="classJournalData.html#a10">JournalData::saveAndClear</a>()
00260 {
00261     <span class="keywordflow">for</span>(vector&lt;JournalRecord*&gt;::const_iterator it = <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.begin();
00262                     it != <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.end(); ++it)
00263     {
00264         <span class="keywordflow">if</span>((*it) != 0)
00265             <a class="code" href="classJournalData.html#r1">journalVec</a>.push_back(*it);
00266     }
00267 
00268     <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.clear();
00269 
00270     emit <a class="code" href="classJournalData.html#l1">saveToDisk</a>();
00271 
00272     emit <a class="code" href="classJournalData.html#l0">journalTmpChanged</a>();
00273 }
00274 
<a name="l00275"></a><a class="code" href="classJournalData.html#a15">00275</a> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> <a class="code" href="classJournalData.html#a15">JournalData::convertCurrency</a>(<span class="keyword">const</span> Q_INT64 amount)<span class="keyword"> const</span>
00276 <span class="keyword"></span>{
00277     <span class="keywordtype">bool</span> neg = <span class="keyword">false</span>;
00278     <span class="keywordflow">if</span>(amount &lt; 0)
00279     neg = <span class="keyword">true</span>;
00280 
00281     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> sumString = QString::number(std::abs(amount));
00282     <span class="keywordtype">int</span> length = sumString.length();
00283 
00284     <span class="keywordflow">if</span>(length == 1)
00285         sumString = sumString.insert(0, <span class="stringliteral">"0.0"</span>);
00286     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(length == 2)
00287         sumString = sumString.insert(0, <span class="stringliteral">"0."</span>);
00288     <span class="keywordflow">else</span>
00289         sumString = sumString.insert(length - 2, <span class="charliteral">'.'</span>);
00290 
00291     <span class="keywordflow">if</span>(neg)
00292     sumString = sumString.insert(0, <span class="stringliteral">"-"</span>);
00293 
00294     <span class="keywordflow">return</span> sumString;
00295 }
00296 
<a name="l00297"></a><a class="code" href="classJournalData.html#a11">00297</a> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> <a class="code" href="classJournalData.html#a11">JournalData::journalTmpDebit</a>()<span class="keyword"> const</span>
00298 <span class="keyword"></span>{
00299     Q_INT64 sum = 0;
00300     <span class="keywordflow">for</span>(vector&lt;JournalRecord*&gt;::const_iterator it = <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.begin();
00301                     it != <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.end(); ++it)
00302     {
00303         <span class="keywordflow">if</span>((*it) != 0)
00304         {
00305             <span class="keywordflow">if</span>((*it)-&gt;amount &gt; 0)
00306                 sum += (*it)-&gt;amount;
00307         }
00308     }
00309     
00310     <span class="keywordflow">return</span> <a class="code" href="classJournalData.html#a15">convertCurrency</a>(sum);
00311 }
00312 
<a name="l00313"></a><a class="code" href="classJournalData.html#a12">00313</a> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> <a class="code" href="classJournalData.html#a12">JournalData::journalTmpCredit</a>()<span class="keyword"> const</span>
00314 <span class="keyword"></span>{
00315     Q_INT64 sum = 0;
00316     <span class="keywordflow">for</span>(vector&lt;JournalRecord*&gt;::const_iterator it = <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.begin();
00317                     it != <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.end(); ++it)
00318     {
00319         <span class="keywordflow">if</span>((*it) != 0)
00320         {
00321             <span class="keywordflow">if</span>((*it)-&gt;amount &lt; 0)
00322                 sum += abs((*it)-&gt;amount);
00323         }
00324     }
00325 
00326     <span class="keywordflow">return</span> <a class="code" href="classJournalData.html#a15">convertCurrency</a>(sum);
00327 }
00328 
<a name="l00329"></a><a class="code" href="classJournalData.html#a13">00329</a> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> <a class="code" href="classJournalData.html#a13">JournalData::journalTmpBalance</a>()<span class="keyword"> const</span>
00330 <span class="keyword"></span>{
00331     Q_INT64 sum = 0;
00332     <span class="keywordflow">for</span>(vector&lt;JournalRecord*&gt;::const_iterator it = <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.begin(); it != <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.end(); ++it)
00333     {
00334         <span class="keywordflow">if</span>((*it) != 0)
00335             sum += (*it)-&gt;amount;
00336     }
00337 
00338     <span class="keywordflow">return</span> <a class="code" href="classJournalData.html#a15">convertCurrency</a>(sum);
00339 }
00340 
<a name="l00341"></a><a class="code" href="classJournalData.html#a14">00341</a> <span class="keywordtype">bool</span> <a class="code" href="classJournalData.html#a14">JournalData::journalTmpEmpty</a>()<span class="keyword"> const</span>
00342 <span class="keyword"></span>{
00343     <span class="keywordtype">bool</span> empty = <span class="keyword">true</span>;
00344     <span class="keywordflow">for</span>(vector&lt;JournalRecord*&gt;::const_iterator it = <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.begin(); it != <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.end(); ++it)
00345     {
00346         <span class="keywordflow">if</span>((*it) != 0)
00347         {
00348             empty = <span class="keyword">false</span>;
00349             <span class="keywordflow">break</span>;
00350         }
00351     }
00352 
00353     <span class="keywordflow">return</span> empty;
00354 }
00355 
<a name="l00356"></a><a class="code" href="classJournalData.html#a16">00356</a> <span class="keywordtype">bool</span> <a class="code" href="classJournalData.html#a16">JournalData::accountHasEntries</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> <span class="keywordtype">id</span>)<span class="keyword"> const</span>
00357 <span class="keyword"></span>{
00358     <span class="comment">// decision: only check journal records, not journalTmp</span>
00359 
00360     <span class="keywordtype">bool</span> hasEntries = <span class="keyword">false</span>;
00361     <span class="keywordflow">for</span>(vector&lt;JournalRecord*&gt;::const_iterator it = <a class="code" href="classJournalData.html#r1">journalVec</a>.begin(); it != <a class="code" href="classJournalData.html#r1">journalVec</a>.end(); ++it)
00362     {
00363         <span class="keywordflow">if</span>((*it) != 0)
00364         {
00365             <span class="keywordflow">if</span>((*it)-&gt;account == <span class="keywordtype">id</span>)
00366             {
00367                 hasEntries = <span class="keyword">true</span>;
00368                 <span class="keywordflow">break</span>;
00369             }
00370         }
00371     }
00372 
00373     <span class="keywordflow">return</span> hasEntries;
00374 }
00375 
<a name="l00376"></a><a class="code" href="classJournalData.html#a19">00376</a> <span class="keywordtype">void</span> <a class="code" href="classJournalData.html#a19">JournalData::importCSV</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qtextstream.html">QTextStream</a> &amp;in)
00377 {
00378     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> line;
00379     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> dateString;
00380     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> account;
00381     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> reference;
00382     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> desc;
00383     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> debit;
00384     <a class="codeRef" doxygen="doxy-qt.tag:" href="qstring.html">QString</a> credit;
00385 
00386     <a class="codeRef" doxygen="doxy-qt.tag:" href="qregexp.html">QRegExp</a> regExp(<span class="stringliteral">"^\"?(\\d\\d\\d\\d-\\d\\d-\\d\\d)\"?,"</span>
00387                    <span class="stringliteral">"\"?(?\\d+-?\\d*)\"?,\"?(.*)\"?,\"?(.*)\"?,"</span>
00388                    <span class="stringliteral">"\"?(\\(?-?\\d*\\.?\\d?\\d?\\)?)\"?,"</span>
00389                    <span class="stringliteral">"\"?(\\(?-?\\d*\\.?\\d?\\d?\\)?)\"?"</span>);
00390 
00391     <span class="keywordflow">while</span>(line = in.readLine())
00392     {
00393         <span class="keywordflow">if</span>(regExp.search(line) == -1)
00394             <span class="keywordflow">continue</span>;
00395 
00396         dateString = regExp.cap(1);
00397         account = regExp.cap(2);
00398         reference = regExp.cap(3);
00399         desc = regExp.cap(4);
00400         debit = regExp.cap(5);
00401         credit = regExp.cap(6);
00402 
00403         <a class="codeRef" doxygen="doxy-qt.tag:" href="qdate.html">QDate</a> date = QDate::fromString(dateString, Qt::ISODate);
00404 
00405         Q_INT64 amount = 0;
00406 
00407         <a class="codeRef" doxygen="doxy-qt.tag:" href="qregexp.html">QRegExp</a> creditRegExp(<span class="stringliteral">"^\\(?-?(\\d*)\\.?(\\d?\\d?)\\)?$"</span>);
00408         creditRegExp.search(credit);
00409 
00410         amount = 0 - (creditRegExp.cap(1) + creditRegExp.cap(2)).toULongLong();
00411 
00412         <a class="codeRef" doxygen="doxy-qt.tag:" href="qregexp.html">QRegExp</a> debitRegExp(<span class="stringliteral">"^(\\d+)\\.?(\\d?\\d?)$"</span>);
00413         debitRegExp.search(debit);
00414 
00415         amount += (debitRegExp.cap(1) + debitRegExp.cap(2)).toULongLong();
00416 
00417  
00418         <a class="code" href="structJournalData_1_1JournalRecord.html">JournalRecord</a> *journalRecord = <span class="keyword">new</span> <a class="code" href="structJournalData_1_1JournalRecord.html">JournalRecord</a>;
00419 
00420         journalRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o0">date</a> = date;
00421         journalRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o1">account</a> = account;
00422         journalRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o2">reference</a> = reference;
00423         journalRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o3">desc</a> = desc;
00424         journalRecord-&gt;<a class="code" href="structJournalData_1_1JournalRecord.html#o4">amount</a> = amount;
00425 
00426         <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.push_back(journalRecord);
00427     }
00428 
00429     emit <a class="code" href="classJournalData.html#l1">saveToDisk</a>();
00430 
00431     emit <a class="code" href="classJournalData.html#l0">journalTmpChanged</a>();
00432 }
00433 
<a name="l00434"></a><a class="code" href="classJournalData.html#a20">00434</a> <span class="keywordtype">void</span> <a class="code" href="classJournalData.html#a20">JournalData::exportCSV</a>(<a class="codeRef" doxygen="doxy-qt.tag:" href="qtextstream.html">QTextStream</a> &amp;out)
00435 {
00436     out &lt;&lt; <span class="stringliteral">"\"Date\",\"Account\",\"Reference\","</span>
00437            <span class="stringliteral">"\"Description\",\"Debit\",\"Credit\"\n"</span>;
00438 
00439     <span class="keywordflow">for</span>(vector&lt;JournalRecord*&gt;::const_iterator it = <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.begin();
00440         it != <a class="code" href="classJournalData.html#r0">journalTmpVec</a>.end(); ++it)
00441     {
00442         out &lt;&lt; <span class="stringliteral">"\""</span> &lt;&lt; (*it)-&gt;date.toString(Qt::ISODate) &lt;&lt; <span class="stringliteral">"\",\""</span>
00443             &lt;&lt; (*it)-&gt;account &lt;&lt; <span class="stringliteral">"\",\""</span> &lt;&lt; (*it)-&gt;reference &lt;&lt; <span class="stringliteral">"\",\""</span>
00444             &lt;&lt; (*it)-&gt;desc &lt;&lt; <span class="stringliteral">"\","</span>;
00445 
00446         <span class="keywordflow">if</span>((*it)-&gt;amount &lt; 0)
00447         {
00448             out &lt;&lt; <span class="stringliteral">"0.00,"</span>
00449                 &lt;&lt; <a class="code" href="main_8h.html#a0">formatCurrency</a>((*it)-&gt;amount, <span class="keyword">false</span>);
00450         }
00451         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((*it)-&gt;amount &gt; 0)
00452         {
00453             out &lt;&lt; <a class="code" href="main_8h.html#a0">formatCurrency</a>((*it)-&gt;amount, <span class="keyword">false</span>)
00454                 &lt;&lt; <span class="stringliteral">",0.00"</span>;
00455         }
00456         <span class="keywordflow">else</span>
00457         {
00458             out &lt;&lt; <span class="stringliteral">"0.00,0.00"</span>;
00459         }
00460         out &lt;&lt; <span class="stringliteral">"\n"</span>;
00461     }
00462 }
00463 
00464 <span class="comment">// Private</span>
00465 
<a name="l00466"></a><a class="code" href="classJournalData.html#d0">00466</a> <a class="code" href="classJournalData.html#d0">JournalData::JournalData</a>() : <a class="codeRef" doxygen="doxy-qt.tag:" href="qobject.html">QObject</a>(0, "<a class="code" href="classJournalData.html">JournalData</a>")
00467 {}
00468 
<a name="l00469"></a><a class="code" href="classJournalData.html#d1">00469</a> <a class="code" href="classJournalData.html#d1">JournalData::~JournalData</a>()
00470 {}
00471 
00472 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Jan 16 16:23:28 2005 for General Ledger by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
